<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>eval.ml &mdash; Coverage report</title>
    <meta name="description" content="80.35% coverage in lib/eval/eval.ml">
    <link rel="stylesheet" href="../../coverage.css"/>
    <script src="../../highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <div id="header">
      <h1>
        <a href="../../index.html">
          <span class="dirname">lib/eval/</span>eval.ml
        </a>
      </h1>
      <h2>80.35%</h2>
    </div>
    <div id="navbar">
      <span class="unvisited" style="top:1.82%"></span>
      <span class="unvisited" style="top:2.10%"></span>
      <span class="unvisited" style="top:2.38%"></span>
      <span class="unvisited" style="top:2.52%"></span>
      <span class="unvisited" style="top:2.66%"></span>
      <span class="unvisited" style="top:2.95%"></span>
      <span class="unvisited" style="top:3.09%"></span>
      <span class="unvisited" style="top:19.92%"></span>
      <span class="unvisited" style="top:20.48%"></span>
      <span class="unvisited" style="top:21.18%"></span>
      <span class="unvisited" style="top:22.02%"></span>
      <span class="unvisited" style="top:27.35%"></span>
      <span class="unvisited" style="top:31.56%"></span>
      <span class="unvisited" style="top:32.12%"></span>
      <span class="unvisited" style="top:32.40%"></span>
      <span class="unvisited" style="top:32.68%"></span>
      <span class="unvisited" style="top:32.82%"></span>
      <span class="unvisited" style="top:33.24%"></span>
      <span class="unvisited" style="top:33.52%"></span>
      <span class="unvisited" style="top:34.36%"></span>
      <span class="unvisited" style="top:34.50%"></span>
      <span class="unvisited" style="top:34.64%"></span>
      <span class="unvisited" style="top:34.78%"></span>
      <span class="unvisited" style="top:35.48%"></span>
      <span class="unvisited" style="top:38.57%"></span>
      <span class="unvisited" style="top:39.13%"></span>
      <span class="unvisited" style="top:43.06%"></span>
      <span class="unvisited" style="top:43.76%"></span>
      <span class="unvisited" style="top:45.02%"></span>
      <span class="unvisited" style="top:45.16%"></span>
      <span class="unvisited" style="top:46.28%"></span>
      <span class="unvisited" style="top:46.56%"></span>
      <span class="unvisited" style="top:47.41%"></span>
      <span class="unvisited" style="top:47.55%"></span>
      <span class="unvisited" style="top:47.69%"></span>
      <span class="unvisited" style="top:48.11%"></span>
      <span class="unvisited" style="top:48.25%"></span>
      <span class="unvisited" style="top:48.39%"></span>
      <span class="unvisited" style="top:48.53%"></span>
      <span class="unvisited" style="top:48.67%"></span>
      <span class="some-visited" style="top:48.81%"></span>
      <span class="unvisited" style="bottom:49.65%"></span>
      <span class="unvisited" style="bottom:49.23%"></span>
      <span class="unvisited" style="bottom:48.95%"></span>
      <span class="unvisited" style="bottom:48.81%"></span>
      <span class="unvisited" style="bottom:47.83%"></span>
      <span class="unvisited" style="bottom:45.44%"></span>
      <span class="unvisited" style="bottom:42.50%"></span>
      <span class="unvisited" style="bottom:42.36%"></span>
      <span class="unvisited" style="bottom:41.65%"></span>
      <span class="unvisited" style="bottom:41.51%"></span>
      <span class="unvisited" style="bottom:41.23%"></span>
      <span class="unvisited" style="bottom:40.95%"></span>
      <span class="unvisited" style="bottom:40.81%"></span>
      <span class="unvisited" style="bottom:39.97%"></span>
      <span class="unvisited" style="bottom:39.83%"></span>
      <span class="unvisited" style="bottom:39.55%"></span>
      <span class="unvisited" style="bottom:39.41%"></span>
      <span class="unvisited" style="bottom:38.71%"></span>
      <span class="unvisited" style="bottom:38.01%"></span>
      <span class="unvisited" style="bottom:35.34%"></span>
      <span class="unvisited" style="bottom:35.20%"></span>
      <span class="unvisited" style="bottom:34.92%"></span>
      <span class="unvisited" style="bottom:34.78%"></span>
      <span class="unvisited" style="bottom:34.64%"></span>
      <span class="unvisited" style="bottom:33.80%"></span>
      <span class="unvisited" style="bottom:33.66%"></span>
      <span class="unvisited" style="bottom:33.38%"></span>
      <span class="unvisited" style="bottom:33.24%"></span>
      <span class="unvisited" style="bottom:31.70%"></span>
      <span class="unvisited" style="bottom:31.00%"></span>
      <span class="unvisited" style="bottom:30.86%"></span>
      <span class="unvisited" style="bottom:30.58%"></span>
      <span class="unvisited" style="bottom:30.43%"></span>
      <span class="unvisited" style="bottom:29.17%"></span>
      <span class="unvisited" style="bottom:29.03%"></span>
      <span class="unvisited" style="bottom:28.75%"></span>
      <span class="unvisited" style="bottom:28.61%"></span>
      <span class="unvisited" style="bottom:28.47%"></span>
      <span class="unvisited" style="bottom:26.37%"></span>
      <span class="unvisited" style="bottom:21.88%"></span>
      <span class="unvisited" style="bottom:21.60%"></span>
      <span class="unvisited" style="bottom:21.46%"></span>
      <span class="unvisited" style="bottom:17.53%"></span>
      <span class="unvisited" style="bottom:13.04%"></span>
      <span class="unvisited" style="bottom:12.34%"></span>
      <span class="unvisited" style="bottom:12.20%"></span>
      <span class="unvisited" style="bottom:10.80%"></span>
      <span class="unvisited" style="bottom:10.66%"></span>
      <span class="unvisited" style="bottom:10.52%"></span>
      <span class="unvisited" style="bottom:10.38%"></span>
      <span class="unvisited" style="bottom:9.54%"></span>
    </div>
    <div id="report">
      <div id="lines-layer">
        <pre>
<a id="L1"></a><span > </span>
<a id="L2"></a><span > </span>
<a id="L3"></a><span > </span>
<a id="L4"></a><span > </span>
<a id="L5"></a><span > </span>
<a id="L6"></a><span > </span>
<a id="L7"></a><span > </span>
<a id="L8"></a><span > </span>
<a id="L9"></a><span > </span>
<a id="L10"></a><span > </span>
<a id="L11"></a><span class="visited"> </span>
<a id="L12"></a><span class="visited"> </span>
<a id="L13"></a><span class="unvisited"> </span>
<a id="L14"></a><span class="visited"> </span>
<a id="L15"></a><span class="unvisited"> </span>
<a id="L16"></a><span > </span>
<a id="L17"></a><span class="unvisited"> </span>
<a id="L18"></a><span class="unvisited"> </span>
<a id="L19"></a><span class="unvisited"> </span>
<a id="L20"></a><span > </span>
<a id="L21"></a><span class="unvisited"> </span>
<a id="L22"></a><span class="unvisited"> </span>
<a id="L23"></a><span class="visited"> </span>
<a id="L24"></a><span class="visited"> </span>
<a id="L25"></a><span > </span>
<a id="L26"></a><span > </span>
<a id="L27"></a><span class="visited"> </span>
<a id="L28"></a><span > </span>
<a id="L29"></a><span > </span>
<a id="L30"></a><span > </span>
<a id="L31"></a><span > </span>
<a id="L32"></a><span class="visited"> </span>
<a id="L33"></a><span > </span>
<a id="L34"></a><span class="visited"> </span>
<a id="L35"></a><span class="visited"> </span>
<a id="L36"></a><span > </span>
<a id="L37"></a><span > </span>
<a id="L38"></a><span > </span>
<a id="L39"></a><span class="visited"> </span>
<a id="L40"></a><span class="visited"> </span>
<a id="L41"></a><span class="visited"> </span>
<a id="L42"></a><span > </span>
<a id="L43"></a><span class="visited"> </span>
<a id="L44"></a><span class="visited"> </span>
<a id="L45"></a><span > </span>
<a id="L46"></a><span > </span>
<a id="L47"></a><span > </span>
<a id="L48"></a><span > </span>
<a id="L49"></a><span > </span>
<a id="L50"></a><span > </span>
<a id="L51"></a><span class="visited"> </span>
<a id="L52"></a><span > </span>
<a id="L53"></a><span class="visited"> </span>
<a id="L54"></a><span class="visited"> </span>
<a id="L55"></a><span > </span>
<a id="L56"></a><span > </span>
<a id="L57"></a><span class="visited"> </span>
<a id="L58"></a><span class="visited"> </span>
<a id="L59"></a><span > </span>
<a id="L60"></a><span > </span>
<a id="L61"></a><span class="visited"> </span>
<a id="L62"></a><span class="visited"> </span>
<a id="L63"></a><span > </span>
<a id="L64"></a><span > </span>
<a id="L65"></a><span class="visited"> </span>
<a id="L66"></a><span class="visited"> </span>
<a id="L67"></a><span > </span>
<a id="L68"></a><span > </span>
<a id="L69"></a><span > </span>
<a id="L70"></a><span class="visited"> </span>
<a id="L71"></a><span class="visited"> </span>
<a id="L72"></a><span class="visited"> </span>
<a id="L73"></a><span class="visited"> </span>
<a id="L74"></a><span class="visited"> </span>
<a id="L75"></a><span > </span>
<a id="L76"></a><span > </span>
<a id="L77"></a><span > </span>
<a id="L78"></a><span > </span>
<a id="L79"></a><span > </span>
<a id="L80"></a><span class="visited"> </span>
<a id="L81"></a><span class="visited"> </span>
<a id="L82"></a><span > </span>
<a id="L83"></a><span class="visited"> </span>
<a id="L84"></a><span class="visited"> </span>
<a id="L85"></a><span class="visited"> </span>
<a id="L86"></a><span > </span>
<a id="L87"></a><span class="visited"> </span>
<a id="L88"></a><span > </span>
<a id="L89"></a><span > </span>
<a id="L90"></a><span class="visited"> </span>
<a id="L91"></a><span > </span>
<a id="L92"></a><span > </span>
<a id="L93"></a><span class="visited"> </span>
<a id="L94"></a><span class="visited"> </span>
<a id="L95"></a><span class="visited"> </span>
<a id="L96"></a><span class="visited"> </span>
<a id="L97"></a><span > </span>
<a id="L98"></a><span class="visited"> </span>
<a id="L99"></a><span > </span>
<a id="L100"></a><span > </span>
<a id="L101"></a><span class="visited"> </span>
<a id="L102"></a><span > </span>
<a id="L103"></a><span class="visited"> </span>
<a id="L104"></a><span > </span>
<a id="L105"></a><span > </span>
<a id="L106"></a><span > </span>
<a id="L107"></a><span > </span>
<a id="L108"></a><span > </span>
<a id="L109"></a><span > </span>
<a id="L110"></a><span > </span>
<a id="L111"></a><span class="visited"> </span>
<a id="L112"></a><span class="visited"> </span>
<a id="L113"></a><span class="visited"> </span>
<a id="L114"></a><span class="visited"> </span>
<a id="L115"></a><span class="visited"> </span>
<a id="L116"></a><span class="visited"> </span>
<a id="L117"></a><span class="visited"> </span>
<a id="L118"></a><span > </span>
<a id="L119"></a><span class="visited"> </span>
<a id="L120"></a><span > </span>
<a id="L121"></a><span > </span>
<a id="L122"></a><span > </span>
<a id="L123"></a><span class="visited"> </span>
<a id="L124"></a><span class="visited"> </span>
<a id="L125"></a><span class="visited"> </span>
<a id="L126"></a><span class="visited"> </span>
<a id="L127"></a><span class="visited"> </span>
<a id="L128"></a><span > </span>
<a id="L129"></a><span class="visited"> </span>
<a id="L130"></a><span class="visited"> </span>
<a id="L131"></a><span class="visited"> </span>
<a id="L132"></a><span class="visited"> </span>
<a id="L133"></a><span class="visited"> </span>
<a id="L134"></a><span class="visited"> </span>
<a id="L135"></a><span > </span>
<a id="L136"></a><span class="visited"> </span>
<a id="L137"></a><span class="visited"> </span>
<a id="L138"></a><span > </span>
<a id="L139"></a><span class="visited"> </span>
<a id="L140"></a><span class="visited"> </span>
<a id="L141"></a><span class="visited"> </span>
<a id="L142"></a><span class="unvisited"> </span>
<a id="L143"></a><span > </span>
<a id="L144"></a><span > </span>
<a id="L145"></a><span class="visited"> </span>
<a id="L146"></a><span class="unvisited"> </span>
<a id="L147"></a><span class="visited"> </span>
<a id="L148"></a><span class="visited"> </span>
<a id="L149"></a><span > </span>
<a id="L150"></a><span class="visited"> </span>
<a id="L151"></a><span class="unvisited"> </span>
<a id="L152"></a><span class="visited"> </span>
<a id="L153"></a><span > </span>
<a id="L154"></a><span > </span>
<a id="L155"></a><span class="visited"> </span>
<a id="L156"></a><span > </span>
<a id="L157"></a><span class="unvisited"> </span>
<a id="L158"></a><span class="visited"> </span>
<a id="L159"></a><span class="visited"> </span>
<a id="L160"></a><span class="visited"> </span>
<a id="L161"></a><span > </span>
<a id="L162"></a><span class="visited"> </span>
<a id="L163"></a><span > </span>
<a id="L164"></a><span > </span>
<a id="L165"></a><span > </span>
<a id="L166"></a><span > </span>
<a id="L167"></a><span > </span>
<a id="L168"></a><span class="visited"> </span>
<a id="L169"></a><span class="visited"> </span>
<a id="L170"></a><span > </span>
<a id="L171"></a><span class="visited"> </span>
<a id="L172"></a><span class="visited"> </span>
<a id="L173"></a><span class="visited"> </span>
<a id="L174"></a><span class="visited"> </span>
<a id="L175"></a><span class="visited"> </span>
<a id="L176"></a><span > </span>
<a id="L177"></a><span class="visited"> </span>
<a id="L178"></a><span > </span>
<a id="L179"></a><span > </span>
<a id="L180"></a><span > </span>
<a id="L181"></a><span > </span>
<a id="L182"></a><span > </span>
<a id="L183"></a><span > </span>
<a id="L184"></a><span class="visited"> </span>
<a id="L185"></a><span class="visited"> </span>
<a id="L186"></a><span > </span>
<a id="L187"></a><span class="visited"> </span>
<a id="L188"></a><span > </span>
<a id="L189"></a><span class="visited"> </span>
<a id="L190"></a><span > </span>
<a id="L191"></a><span class="visited"> </span>
<a id="L192"></a><span class="visited"> </span>
<a id="L193"></a><span class="visited"> </span>
<a id="L194"></a><span class="visited"> </span>
<a id="L195"></a><span class="unvisited"> </span>
<a id="L196"></a><span > </span>
<a id="L197"></a><span > </span>
<a id="L198"></a><span class="visited"> </span>
<a id="L199"></a><span > </span>
<a id="L200"></a><span class="visited"> </span>
<a id="L201"></a><span class="visited"> </span>
<a id="L202"></a><span class="visited"> </span>
<a id="L203"></a><span > </span>
<a id="L204"></a><span class="visited"> </span>
<a id="L205"></a><span > </span>
<a id="L206"></a><span > </span>
<a id="L207"></a><span > </span>
<a id="L208"></a><span > </span>
<a id="L209"></a><span > </span>
<a id="L210"></a><span > </span>
<a id="L211"></a><span > </span>
<a id="L212"></a><span class="visited"> </span>
<a id="L213"></a><span class="visited"> </span>
<a id="L214"></a><span > </span>
<a id="L215"></a><span class="visited"> </span>
<a id="L216"></a><span > </span>
<a id="L217"></a><span class="visited"> </span>
<a id="L218"></a><span > </span>
<a id="L219"></a><span class="visited"> </span>
<a id="L220"></a><span > </span>
<a id="L221"></a><span class="visited"> </span>
<a id="L222"></a><span class="visited"> </span>
<a id="L223"></a><span class="visited"> </span>
<a id="L224"></a><span class="visited"> </span>
<a id="L225"></a><span class="unvisited"> </span>
<a id="L226"></a><span > </span>
<a id="L227"></a><span > </span>
<a id="L228"></a><span class="visited"> </span>
<a id="L229"></a><span class="unvisited"> </span>
<a id="L230"></a><span class="visited"> </span>
<a id="L231"></a><span class="unvisited"> </span>
<a id="L232"></a><span > </span>
<a id="L233"></a><span class="unvisited"> </span>
<a id="L234"></a><span class="unvisited"> </span>
<a id="L235"></a><span > </span>
<a id="L236"></a><span > </span>
<a id="L237"></a><span class="unvisited"> </span>
<a id="L238"></a><span > </span>
<a id="L239"></a><span class="unvisited"> </span>
<a id="L240"></a><span > </span>
<a id="L241"></a><span > </span>
<a id="L242"></a><span > </span>
<a id="L243"></a><span > </span>
<a id="L244"></a><span > </span>
<a id="L245"></a><span class="unvisited"> </span>
<a id="L246"></a><span class="unvisited"> </span>
<a id="L247"></a><span class="unvisited"> </span>
<a id="L248"></a><span class="unvisited"> </span>
<a id="L249"></a><span class="visited"> </span>
<a id="L250"></a><span class="visited"> </span>
<a id="L251"></a><span class="visited"> </span>
<a id="L252"></a><span class="visited"> </span>
<a id="L253"></a><span class="unvisited"> </span>
<a id="L254"></a><span > </span>
<a id="L255"></a><span > </span>
<a id="L256"></a><span class="visited"> </span>
<a id="L257"></a><span > </span>
<a id="L258"></a><span class="visited"> </span>
<a id="L259"></a><span > </span>
<a id="L260"></a><span > </span>
<a id="L261"></a><span > </span>
<a id="L262"></a><span > </span>
<a id="L263"></a><span > </span>
<a id="L264"></a><span > </span>
<a id="L265"></a><span class="visited"> </span>
<a id="L266"></a><span class="visited"> </span>
<a id="L267"></a><span class="visited"> </span>
<a id="L268"></a><span > </span>
<a id="L269"></a><span class="visited"> </span>
<a id="L270"></a><span > </span>
<a id="L271"></a><span class="visited"> </span>
<a id="L272"></a><span class="visited"> </span>
<a id="L273"></a><span class="visited"> </span>
<a id="L274"></a><span class="visited"> </span>
<a id="L275"></a><span class="unvisited"> </span>
<a id="L276"></a><span > </span>
<a id="L277"></a><span > </span>
<a id="L278"></a><span class="visited"> </span>
<a id="L279"></a><span class="unvisited"> </span>
<a id="L280"></a><span > </span>
<a id="L281"></a><span > </span>
<a id="L282"></a><span class="visited"> </span>
<a id="L283"></a><span class="visited"> </span>
<a id="L284"></a><span class="visited"> </span>
<a id="L285"></a><span class="visited"> </span>
<a id="L286"></a><span > </span>
<a id="L287"></a><span class="visited"> </span>
<a id="L288"></a><span > </span>
<a id="L289"></a><span > </span>
<a id="L290"></a><span class="visited"> </span>
<a id="L291"></a><span class="visited"> </span>
<a id="L292"></a><span class="visited"> </span>
<a id="L293"></a><span > </span>
<a id="L294"></a><span > </span>
<a id="L295"></a><span class="visited"> </span>
<a id="L296"></a><span > </span>
<a id="L297"></a><span class="visited"> </span>
<a id="L298"></a><span class="visited"> </span>
<a id="L299"></a><span > </span>
<a id="L300"></a><span class="visited"> </span>
<a id="L301"></a><span class="visited"> </span>
<a id="L302"></a><span > </span>
<a id="L303"></a><span class="visited"> </span>
<a id="L304"></a><span class="visited"> </span>
<a id="L305"></a><span > </span>
<a id="L306"></a><span class="visited"> </span>
<a id="L307"></a><span class="unvisited"> </span>
<a id="L308"></a><span class="visited"> </span>
<a id="L309"></a><span > </span>
<a id="L310"></a><span class="visited"> </span>
<a id="L311"></a><span class="visited"> </span>
<a id="L312"></a><span class="unvisited"> </span>
<a id="L313"></a><span class="visited"> </span>
<a id="L314"></a><span class="visited"> </span>
<a id="L315"></a><span > </span>
<a id="L316"></a><span > </span>
<a id="L317"></a><span class="visited"> </span>
<a id="L318"></a><span > </span>
<a id="L319"></a><span > </span>
<a id="L320"></a><span class="visited"> </span>
<a id="L321"></a><span class="unvisited"> </span>
<a id="L322"></a><span class="unvisited"> </span>
<a id="L323"></a><span > </span>
<a id="L324"></a><span > </span>
<a id="L325"></a><span class="visited"> </span>
<a id="L326"></a><span class="visited"> </span>
<a id="L327"></a><span class="visited"> </span>
<a id="L328"></a><span class="visited"> </span>
<a id="L329"></a><span class="visited"> </span>
<a id="L330"></a><span class="unvisited"> </span>
<a id="L331"></a><span class="visited"> </span>
<a id="L332"></a><span class="unvisited"> </span>
<a id="L333"></a><span > </span>
<a id="L334"></a><span > </span>
<a id="L335"></a><span class="visited"> </span>
<a id="L336"></a><span class="visited"> </span>
<a id="L337"></a><span class="visited"> </span>
<a id="L338"></a><span class="unvisited"> </span>
<a id="L339"></a><span class="unvisited"> </span>
<a id="L340"></a><span class="unvisited"> </span>
<a id="L341"></a><span > </span>
<a id="L342"></a><span > </span>
<a id="L343"></a><span class="unvisited"> </span>
<a id="L344"></a><span class="unvisited"> </span>
<a id="L345"></a><span class="unvisited"> </span>
<a id="L346"></a><span class="unvisited"> </span>
<a id="L347"></a><span class="unvisited"> </span>
<a id="L348"></a><span class="some-visited"> </span>
<a id="L349"></a><span class="visited"> </span>
<a id="L350"></a><span > </span>
<a id="L351"></a><span > </span>
<a id="L352"></a><span class="visited"> </span>
<a id="L353"></a><span class="visited"> </span>
<a id="L354"></a><span class="visited"> </span>
<a id="L355"></a><span class="visited"> </span>
<a id="L356"></a><span class="visited"> </span>
<a id="L357"></a><span class="visited"> </span>
<a id="L358"></a><span class="visited"> </span>
<a id="L359"></a><span class="unvisited"> </span>
<a id="L360"></a><span class="visited"> </span>
<a id="L361"></a><span class="visited"> </span>
<a id="L362"></a><span class="unvisited"> </span>
<a id="L363"></a><span class="visited"> </span>
<a id="L364"></a><span class="unvisited"> </span>
<a id="L365"></a><span class="unvisited"> </span>
<a id="L366"></a><span class="visited"> </span>
<a id="L367"></a><span class="visited"> </span>
<a id="L368"></a><span class="visited"> </span>
<a id="L369"></a><span class="visited"> </span>
<a id="L370"></a><span class="visited"> </span>
<a id="L371"></a><span class="visited"> </span>
<a id="L372"></a><span class="unvisited"> </span>
<a id="L373"></a><span > </span>
<a id="L374"></a><span > </span>
<a id="L375"></a><span class="visited"> </span>
<a id="L376"></a><span class="visited"> </span>
<a id="L377"></a><span class="visited"> </span>
<a id="L378"></a><span class="visited"> </span>
<a id="L379"></a><span class="visited"> </span>
<a id="L380"></a><span > </span>
<a id="L381"></a><span > </span>
<a id="L382"></a><span class="visited"> </span>
<a id="L383"></a><span class="visited"> </span>
<a id="L384"></a><span class="visited"> </span>
<a id="L385"></a><span class="visited"> </span>
<a id="L386"></a><span class="visited"> </span>
<a id="L387"></a><span > </span>
<a id="L388"></a><span class="visited"> </span>
<a id="L389"></a><span class="unvisited"> </span>
<a id="L390"></a><span > </span>
<a id="L391"></a><span > </span>
<a id="L392"></a><span class="visited"> </span>
<a id="L393"></a><span class="visited"> </span>
<a id="L394"></a><span > </span>
<a id="L395"></a><span > </span>
<a id="L396"></a><span class="visited"> </span>
<a id="L397"></a><span class="visited"> </span>
<a id="L398"></a><span > </span>
<a id="L399"></a><span class="visited"> </span>
<a id="L400"></a><span class="visited"> </span>
<a id="L401"></a><span > </span>
<a id="L402"></a><span class="visited"> </span>
<a id="L403"></a><span class="visited"> </span>
<a id="L404"></a><span class="visited"> </span>
<a id="L405"></a><span > </span>
<a id="L406"></a><span class="visited"> </span>
<a id="L407"></a><span class="visited"> </span>
<a id="L408"></a><span > </span>
<a id="L409"></a><span class="visited"> </span>
<a id="L410"></a><span class="unvisited"> </span>
<a id="L411"></a><span class="unvisited"> </span>
<a id="L412"></a><span > </span>
<a id="L413"></a><span > </span>
<a id="L414"></a><span class="visited"> </span>
<a id="L415"></a><span > </span>
<a id="L416"></a><span class="unvisited"> </span>
<a id="L417"></a><span class="unvisited"> </span>
<a id="L418"></a><span class="visited"> </span>
<a id="L419"></a><span class="unvisited"> </span>
<a id="L420"></a><span class="visited"> </span>
<a id="L421"></a><span class="unvisited"> </span>
<a id="L422"></a><span class="unvisited"> </span>
<a id="L423"></a><span class="visited"> </span>
<a id="L424"></a><span > </span>
<a id="L425"></a><span > </span>
<a id="L426"></a><span class="visited"> </span>
<a id="L427"></a><span class="visited"> </span>
<a id="L428"></a><span class="unvisited"> </span>
<a id="L429"></a><span class="unvisited"> </span>
<a id="L430"></a><span > </span>
<a id="L431"></a><span class="unvisited"> </span>
<a id="L432"></a><span class="unvisited"> </span>
<a id="L433"></a><span class="visited"> </span>
<a id="L434"></a><span class="visited"> </span>
<a id="L435"></a><span > </span>
<a id="L436"></a><span class="visited"> </span>
<a id="L437"></a><span class="unvisited"> </span>
<a id="L438"></a><span class="visited"> </span>
<a id="L439"></a><span class="visited"> </span>
<a id="L440"></a><span class="visited"> </span>
<a id="L441"></a><span class="visited"> </span>
<a id="L442"></a><span class="unvisited"> </span>
<a id="L443"></a><span class="visited"> </span>
<a id="L444"></a><span class="visited"> </span>
<a id="L445"></a><span > </span>
<a id="L446"></a><span class="visited"> </span>
<a id="L447"></a><span class="visited"> </span>
<a id="L448"></a><span class="visited"> </span>
<a id="L449"></a><span class="visited"> </span>
<a id="L450"></a><span class="visited"> </span>
<a id="L451"></a><span class="visited"> </span>
<a id="L452"></a><span class="visited"> </span>
<a id="L453"></a><span class="visited"> </span>
<a id="L454"></a><span class="visited"> </span>
<a id="L455"></a><span > </span>
<a id="L456"></a><span class="visited"> </span>
<a id="L457"></a><span > </span>
<a id="L458"></a><span > </span>
<a id="L459"></a><span class="visited"> </span>
<a id="L460"></a><span > </span>
<a id="L461"></a><span class="unvisited"> </span>
<a id="L462"></a><span class="unvisited"> </span>
<a id="L463"></a><span > </span>
<a id="L464"></a><span class="unvisited"> </span>
<a id="L465"></a><span class="unvisited"> </span>
<a id="L466"></a><span class="unvisited"> </span>
<a id="L467"></a><span class="visited"> </span>
<a id="L468"></a><span > </span>
<a id="L469"></a><span > </span>
<a id="L470"></a><span class="visited"> </span>
<a id="L471"></a><span class="visited"> </span>
<a id="L472"></a><span class="unvisited"> </span>
<a id="L473"></a><span class="unvisited"> </span>
<a id="L474"></a><span > </span>
<a id="L475"></a><span class="unvisited"> </span>
<a id="L476"></a><span class="unvisited"> </span>
<a id="L477"></a><span > </span>
<a id="L478"></a><span > </span>
<a id="L479"></a><span class="visited"> </span>
<a id="L480"></a><span > </span>
<a id="L481"></a><span class="visited"> </span>
<a id="L482"></a><span class="visited"> </span>
<a id="L483"></a><span > </span>
<a id="L484"></a><span class="visited"> </span>
<a id="L485"></a><span class="visited"> </span>
<a id="L486"></a><span class="visited"> </span>
<a id="L487"></a><span class="unvisited"> </span>
<a id="L488"></a><span > </span>
<a id="L489"></a><span > </span>
<a id="L490"></a><span class="visited"> </span>
<a id="L491"></a><span class="visited"> </span>
<a id="L492"></a><span class="unvisited"> </span>
<a id="L493"></a><span class="unvisited"> </span>
<a id="L494"></a><span > </span>
<a id="L495"></a><span class="unvisited"> </span>
<a id="L496"></a><span class="unvisited"> </span>
<a id="L497"></a><span class="visited"> </span>
<a id="L498"></a><span class="visited"> </span>
<a id="L499"></a><span > </span>
<a id="L500"></a><span > </span>
<a id="L501"></a><span class="visited"> </span>
<a id="L502"></a><span > </span>
<a id="L503"></a><span class="visited"> </span>
<a id="L504"></a><span > </span>
<a id="L505"></a><span class="unvisited"> </span>
<a id="L506"></a><span class="unvisited"> </span>
<a id="L507"></a><span > </span>
<a id="L508"></a><span class="unvisited"> </span>
<a id="L509"></a><span class="unvisited"> </span>
<a id="L510"></a><span class="unvisited"> </span>
<a id="L511"></a><span > </span>
<a id="L512"></a><span > </span>
<a id="L513"></a><span class="visited"> </span>
<a id="L514"></a><span > </span>
<a id="L515"></a><span class="visited"> </span>
<a id="L516"></a><span class="visited"> </span>
<a id="L517"></a><span class="visited"> </span>
<a id="L518"></a><span class="visited"> </span>
<a id="L519"></a><span class="visited"> </span>
<a id="L520"></a><span class="visited"> </span>
<a id="L521"></a><span class="visited"> </span>
<a id="L522"></a><span class="visited"> </span>
<a id="L523"></a><span class="visited"> </span>
<a id="L524"></a><span class="visited"> </span>
<a id="L525"></a><span class="unvisited"> </span>
<a id="L526"></a><span class="visited"> </span>
<a id="L527"></a><span class="visited"> </span>
<a id="L528"></a><span class="visited"> </span>
<a id="L529"></a><span class="visited"> </span>
<a id="L530"></a><span class="visited"> </span>
<a id="L531"></a><span class="visited"> </span>
<a id="L532"></a><span > </span>
<a id="L533"></a><span > </span>
<a id="L534"></a><span class="visited"> </span>
<a id="L535"></a><span > </span>
<a id="L536"></a><span class="visited"> </span>
<a id="L537"></a><span > </span>
<a id="L538"></a><span > </span>
<a id="L539"></a><span class="visited"> </span>
<a id="L540"></a><span class="visited"> </span>
<a id="L541"></a><span class="visited"> </span>
<a id="L542"></a><span class="visited"> </span>
<a id="L543"></a><span > </span>
<a id="L544"></a><span class="visited"> </span>
<a id="L545"></a><span > </span>
<a id="L546"></a><span > </span>
<a id="L547"></a><span class="visited"> </span>
<a id="L548"></a><span > </span>
<a id="L549"></a><span class="visited"> </span>
<a id="L550"></a><span class="visited"> </span>
<a id="L551"></a><span class="visited"> </span>
<a id="L552"></a><span class="visited"> </span>
<a id="L553"></a><span class="visited"> </span>
<a id="L554"></a><span > </span>
<a id="L555"></a><span > </span>
<a id="L556"></a><span class="visited"> </span>
<a id="L557"></a><span class="unvisited"> </span>
<a id="L558"></a><span class="visited"> </span>
<a id="L559"></a><span class="unvisited"> </span>
<a id="L560"></a><span class="unvisited"> </span>
<a id="L561"></a><span class="visited"> </span>
<a id="L562"></a><span > </span>
<a id="L563"></a><span > </span>
<a id="L564"></a><span class="visited"> </span>
<a id="L565"></a><span class="visited"> </span>
<a id="L566"></a><span > </span>
<a id="L567"></a><span class="visited"> </span>
<a id="L568"></a><span class="visited"> </span>
<a id="L569"></a><span class="visited"> </span>
<a id="L570"></a><span class="visited"> </span>
<a id="L571"></a><span class="visited"> </span>
<a id="L572"></a><span class="visited"> </span>
<a id="L573"></a><span > </span>
<a id="L574"></a><span class="visited"> </span>
<a id="L575"></a><span class="visited"> </span>
<a id="L576"></a><span class="visited"> </span>
<a id="L577"></a><span > </span>
<a id="L578"></a><span > </span>
<a id="L579"></a><span class="visited"> </span>
<a id="L580"></a><span > </span>
<a id="L581"></a><span > </span>
<a id="L582"></a><span > </span>
<a id="L583"></a><span class="visited"> </span>
<a id="L584"></a><span > </span>
<a id="L585"></a><span > </span>
<a id="L586"></a><span > </span>
<a id="L587"></a><span class="visited"> </span>
<a id="L588"></a><span class="unvisited"> </span>
<a id="L589"></a><span > </span>
<a id="L590"></a><span > </span>
<a id="L591"></a><span class="visited"> </span>
<a id="L592"></a><span > </span>
<a id="L593"></a><span class="visited"> </span>
<a id="L594"></a><span class="visited"> </span>
<a id="L595"></a><span class="visited"> </span>
<a id="L596"></a><span class="visited"> </span>
<a id="L597"></a><span class="visited"> </span>
<a id="L598"></a><span class="visited"> </span>
<a id="L599"></a><span class="visited"> </span>
<a id="L600"></a><span class="visited"> </span>
<a id="L601"></a><span class="visited"> </span>
<a id="L602"></a><span class="visited"> </span>
<a id="L603"></a><span class="visited"> </span>
<a id="L604"></a><span > </span>
<a id="L605"></a><span class="visited"> </span>
<a id="L606"></a><span class="visited"> </span>
<a id="L607"></a><span > </span>
<a id="L608"></a><span > </span>
<a id="L609"></a><span > </span>
<a id="L610"></a><span class="visited"> </span>
<a id="L611"></a><span > </span>
<a id="L612"></a><span > </span>
<a id="L613"></a><span > </span>
<a id="L614"></a><span > </span>
<a id="L615"></a><span > </span>
<a id="L616"></a><span class="visited"> </span>
<a id="L617"></a><span class="visited"> </span>
<a id="L618"></a><span class="visited"> </span>
<a id="L619"></a><span class="visited"> </span>
<a id="L620"></a><span class="unvisited"> </span>
<a id="L621"></a><span > </span>
<a id="L622"></a><span > </span>
<a id="L623"></a><span class="visited"> </span>
<a id="L624"></a><span > </span>
<a id="L625"></a><span class="unvisited"> </span>
<a id="L626"></a><span class="unvisited"> </span>
<a id="L627"></a><span class="visited"> </span>
<a id="L628"></a><span class="visited"> </span>
<a id="L629"></a><span class="visited"> </span>
<a id="L630"></a><span class="visited"> </span>
<a id="L631"></a><span > </span>
<a id="L632"></a><span > </span>
<a id="L633"></a><span > </span>
<a id="L634"></a><span > </span>
<a id="L635"></a><span > </span>
<a id="L636"></a><span class="unvisited"> </span>
<a id="L637"></a><span class="unvisited"> </span>
<a id="L638"></a><span class="unvisited"> </span>
<a id="L639"></a><span class="unvisited"> </span>
<a id="L640"></a><span > </span>
<a id="L641"></a><span > </span>
<a id="L642"></a><span > </span>
<a id="L643"></a><span > </span>
<a id="L644"></a><span > </span>
<a id="L645"></a><span class="unvisited"> </span>
<a id="L646"></a><span > </span>
<a id="L647"></a><span > </span>
<a id="L648"></a><span > </span>
<a id="L649"></a><span class="visited"> </span>
<a id="L650"></a><span class="visited"> </span>
<a id="L651"></a><span class="visited"> </span>
<a id="L652"></a><span class="visited"> </span>
<a id="L653"></a><span class="visited"> </span>
<a id="L654"></a><span class="visited"> </span>
<a id="L655"></a><span class="visited"> </span>
<a id="L656"></a><span class="visited"> </span>
<a id="L657"></a><span class="visited"> </span>
<a id="L658"></a><span class="visited"> </span>
<a id="L659"></a><span > </span>
<a id="L660"></a><span > </span>
<a id="L661"></a><span > </span>
<a id="L662"></a><span class="visited"> </span>
<a id="L663"></a><span class="visited"> </span>
<a id="L664"></a><span > </span>
<a id="L665"></a><span > </span>
<a id="L666"></a><span > </span>
<a id="L667"></a><span > </span>
<a id="L668"></a><span > </span>
<a id="L669"></a><span > </span>
<a id="L670"></a><span class="visited"> </span>
<a id="L671"></a><span class="visited"> </span>
<a id="L672"></a><span > </span>
<a id="L673"></a><span class="visited"> </span>
<a id="L674"></a><span class="visited"> </span>
<a id="L675"></a><span > </span>
<a id="L676"></a><span > </span>
<a id="L677"></a><span > </span>
<a id="L678"></a><span > </span>
<a id="L679"></a><span > </span>
<a id="L680"></a><span > </span>
<a id="L681"></a><span class="visited"> </span>
<a id="L682"></a><span class="visited"> </span>
<a id="L683"></a><span > </span>
<a id="L684"></a><span > </span>
<a id="L685"></a><span > </span>
<a id="L686"></a><span > </span>
<a id="L687"></a><span > </span>
<a id="L688"></a><span > </span>
<a id="L689"></a><span > </span>
<a id="L690"></a><span class="visited"> </span>
<a id="L691"></a><span > </span>
<a id="L692"></a><span > </span>
<a id="L693"></a><span > </span>
<a id="L694"></a><span > </span>
<a id="L695"></a><span > </span>
<a id="L696"></a><span > </span>
<a id="L697"></a><span > </span>
<a id="L698"></a><span > </span>
<a id="L699"></a><span > </span>
<a id="L700"></a><span > </span>
<a id="L701"></a><span > </span>
<a id="L702"></a><span > </span>
<a id="L703"></a><span > </span>
<a id="L704"></a><span > </span>
<a id="L705"></a><span > </span>
<a id="L706"></a><span class="visited"> </span>
<a id="L707"></a><span class="visited"> </span>
<a id="L708"></a><span class="visited"> </span>
<a id="L709"></a><span class="visited"> </span>
<a id="L710"></a><span > </span>
<a id="L711"></a><span class="visited"> </span>
<a id="L712"></a><span class="visited"> </span>
<a id="L713"></a><span > </span>
</pre>
      </div>
      <div id="text-layer">
        <pre id="line-numbers">
<a href="#L1">  1</a>
<a href="#L2">  2</a>
<a href="#L3">  3</a>
<a href="#L4">  4</a>
<a href="#L5">  5</a>
<a href="#L6">  6</a>
<a href="#L7">  7</a>
<a href="#L8">  8</a>
<a href="#L9">  9</a>
<a href="#L10"> 10</a>
<a href="#L11"> 11</a>
<a href="#L12"> 12</a>
<a href="#L13"> 13</a>
<a href="#L14"> 14</a>
<a href="#L15"> 15</a>
<a href="#L16"> 16</a>
<a href="#L17"> 17</a>
<a href="#L18"> 18</a>
<a href="#L19"> 19</a>
<a href="#L20"> 20</a>
<a href="#L21"> 21</a>
<a href="#L22"> 22</a>
<a href="#L23"> 23</a>
<a href="#L24"> 24</a>
<a href="#L25"> 25</a>
<a href="#L26"> 26</a>
<a href="#L27"> 27</a>
<a href="#L28"> 28</a>
<a href="#L29"> 29</a>
<a href="#L30"> 30</a>
<a href="#L31"> 31</a>
<a href="#L32"> 32</a>
<a href="#L33"> 33</a>
<a href="#L34"> 34</a>
<a href="#L35"> 35</a>
<a href="#L36"> 36</a>
<a href="#L37"> 37</a>
<a href="#L38"> 38</a>
<a href="#L39"> 39</a>
<a href="#L40"> 40</a>
<a href="#L41"> 41</a>
<a href="#L42"> 42</a>
<a href="#L43"> 43</a>
<a href="#L44"> 44</a>
<a href="#L45"> 45</a>
<a href="#L46"> 46</a>
<a href="#L47"> 47</a>
<a href="#L48"> 48</a>
<a href="#L49"> 49</a>
<a href="#L50"> 50</a>
<a href="#L51"> 51</a>
<a href="#L52"> 52</a>
<a href="#L53"> 53</a>
<a href="#L54"> 54</a>
<a href="#L55"> 55</a>
<a href="#L56"> 56</a>
<a href="#L57"> 57</a>
<a href="#L58"> 58</a>
<a href="#L59"> 59</a>
<a href="#L60"> 60</a>
<a href="#L61"> 61</a>
<a href="#L62"> 62</a>
<a href="#L63"> 63</a>
<a href="#L64"> 64</a>
<a href="#L65"> 65</a>
<a href="#L66"> 66</a>
<a href="#L67"> 67</a>
<a href="#L68"> 68</a>
<a href="#L69"> 69</a>
<a href="#L70"> 70</a>
<a href="#L71"> 71</a>
<a href="#L72"> 72</a>
<a href="#L73"> 73</a>
<a href="#L74"> 74</a>
<a href="#L75"> 75</a>
<a href="#L76"> 76</a>
<a href="#L77"> 77</a>
<a href="#L78"> 78</a>
<a href="#L79"> 79</a>
<a href="#L80"> 80</a>
<a href="#L81"> 81</a>
<a href="#L82"> 82</a>
<a href="#L83"> 83</a>
<a href="#L84"> 84</a>
<a href="#L85"> 85</a>
<a href="#L86"> 86</a>
<a href="#L87"> 87</a>
<a href="#L88"> 88</a>
<a href="#L89"> 89</a>
<a href="#L90"> 90</a>
<a href="#L91"> 91</a>
<a href="#L92"> 92</a>
<a href="#L93"> 93</a>
<a href="#L94"> 94</a>
<a href="#L95"> 95</a>
<a href="#L96"> 96</a>
<a href="#L97"> 97</a>
<a href="#L98"> 98</a>
<a href="#L99"> 99</a>
<a href="#L100">100</a>
<a href="#L101">101</a>
<a href="#L102">102</a>
<a href="#L103">103</a>
<a href="#L104">104</a>
<a href="#L105">105</a>
<a href="#L106">106</a>
<a href="#L107">107</a>
<a href="#L108">108</a>
<a href="#L109">109</a>
<a href="#L110">110</a>
<a href="#L111">111</a>
<a href="#L112">112</a>
<a href="#L113">113</a>
<a href="#L114">114</a>
<a href="#L115">115</a>
<a href="#L116">116</a>
<a href="#L117">117</a>
<a href="#L118">118</a>
<a href="#L119">119</a>
<a href="#L120">120</a>
<a href="#L121">121</a>
<a href="#L122">122</a>
<a href="#L123">123</a>
<a href="#L124">124</a>
<a href="#L125">125</a>
<a href="#L126">126</a>
<a href="#L127">127</a>
<a href="#L128">128</a>
<a href="#L129">129</a>
<a href="#L130">130</a>
<a href="#L131">131</a>
<a href="#L132">132</a>
<a href="#L133">133</a>
<a href="#L134">134</a>
<a href="#L135">135</a>
<a href="#L136">136</a>
<a href="#L137">137</a>
<a href="#L138">138</a>
<a href="#L139">139</a>
<a href="#L140">140</a>
<a href="#L141">141</a>
<a href="#L142">142</a>
<a href="#L143">143</a>
<a href="#L144">144</a>
<a href="#L145">145</a>
<a href="#L146">146</a>
<a href="#L147">147</a>
<a href="#L148">148</a>
<a href="#L149">149</a>
<a href="#L150">150</a>
<a href="#L151">151</a>
<a href="#L152">152</a>
<a href="#L153">153</a>
<a href="#L154">154</a>
<a href="#L155">155</a>
<a href="#L156">156</a>
<a href="#L157">157</a>
<a href="#L158">158</a>
<a href="#L159">159</a>
<a href="#L160">160</a>
<a href="#L161">161</a>
<a href="#L162">162</a>
<a href="#L163">163</a>
<a href="#L164">164</a>
<a href="#L165">165</a>
<a href="#L166">166</a>
<a href="#L167">167</a>
<a href="#L168">168</a>
<a href="#L169">169</a>
<a href="#L170">170</a>
<a href="#L171">171</a>
<a href="#L172">172</a>
<a href="#L173">173</a>
<a href="#L174">174</a>
<a href="#L175">175</a>
<a href="#L176">176</a>
<a href="#L177">177</a>
<a href="#L178">178</a>
<a href="#L179">179</a>
<a href="#L180">180</a>
<a href="#L181">181</a>
<a href="#L182">182</a>
<a href="#L183">183</a>
<a href="#L184">184</a>
<a href="#L185">185</a>
<a href="#L186">186</a>
<a href="#L187">187</a>
<a href="#L188">188</a>
<a href="#L189">189</a>
<a href="#L190">190</a>
<a href="#L191">191</a>
<a href="#L192">192</a>
<a href="#L193">193</a>
<a href="#L194">194</a>
<a href="#L195">195</a>
<a href="#L196">196</a>
<a href="#L197">197</a>
<a href="#L198">198</a>
<a href="#L199">199</a>
<a href="#L200">200</a>
<a href="#L201">201</a>
<a href="#L202">202</a>
<a href="#L203">203</a>
<a href="#L204">204</a>
<a href="#L205">205</a>
<a href="#L206">206</a>
<a href="#L207">207</a>
<a href="#L208">208</a>
<a href="#L209">209</a>
<a href="#L210">210</a>
<a href="#L211">211</a>
<a href="#L212">212</a>
<a href="#L213">213</a>
<a href="#L214">214</a>
<a href="#L215">215</a>
<a href="#L216">216</a>
<a href="#L217">217</a>
<a href="#L218">218</a>
<a href="#L219">219</a>
<a href="#L220">220</a>
<a href="#L221">221</a>
<a href="#L222">222</a>
<a href="#L223">223</a>
<a href="#L224">224</a>
<a href="#L225">225</a>
<a href="#L226">226</a>
<a href="#L227">227</a>
<a href="#L228">228</a>
<a href="#L229">229</a>
<a href="#L230">230</a>
<a href="#L231">231</a>
<a href="#L232">232</a>
<a href="#L233">233</a>
<a href="#L234">234</a>
<a href="#L235">235</a>
<a href="#L236">236</a>
<a href="#L237">237</a>
<a href="#L238">238</a>
<a href="#L239">239</a>
<a href="#L240">240</a>
<a href="#L241">241</a>
<a href="#L242">242</a>
<a href="#L243">243</a>
<a href="#L244">244</a>
<a href="#L245">245</a>
<a href="#L246">246</a>
<a href="#L247">247</a>
<a href="#L248">248</a>
<a href="#L249">249</a>
<a href="#L250">250</a>
<a href="#L251">251</a>
<a href="#L252">252</a>
<a href="#L253">253</a>
<a href="#L254">254</a>
<a href="#L255">255</a>
<a href="#L256">256</a>
<a href="#L257">257</a>
<a href="#L258">258</a>
<a href="#L259">259</a>
<a href="#L260">260</a>
<a href="#L261">261</a>
<a href="#L262">262</a>
<a href="#L263">263</a>
<a href="#L264">264</a>
<a href="#L265">265</a>
<a href="#L266">266</a>
<a href="#L267">267</a>
<a href="#L268">268</a>
<a href="#L269">269</a>
<a href="#L270">270</a>
<a href="#L271">271</a>
<a href="#L272">272</a>
<a href="#L273">273</a>
<a href="#L274">274</a>
<a href="#L275">275</a>
<a href="#L276">276</a>
<a href="#L277">277</a>
<a href="#L278">278</a>
<a href="#L279">279</a>
<a href="#L280">280</a>
<a href="#L281">281</a>
<a href="#L282">282</a>
<a href="#L283">283</a>
<a href="#L284">284</a>
<a href="#L285">285</a>
<a href="#L286">286</a>
<a href="#L287">287</a>
<a href="#L288">288</a>
<a href="#L289">289</a>
<a href="#L290">290</a>
<a href="#L291">291</a>
<a href="#L292">292</a>
<a href="#L293">293</a>
<a href="#L294">294</a>
<a href="#L295">295</a>
<a href="#L296">296</a>
<a href="#L297">297</a>
<a href="#L298">298</a>
<a href="#L299">299</a>
<a href="#L300">300</a>
<a href="#L301">301</a>
<a href="#L302">302</a>
<a href="#L303">303</a>
<a href="#L304">304</a>
<a href="#L305">305</a>
<a href="#L306">306</a>
<a href="#L307">307</a>
<a href="#L308">308</a>
<a href="#L309">309</a>
<a href="#L310">310</a>
<a href="#L311">311</a>
<a href="#L312">312</a>
<a href="#L313">313</a>
<a href="#L314">314</a>
<a href="#L315">315</a>
<a href="#L316">316</a>
<a href="#L317">317</a>
<a href="#L318">318</a>
<a href="#L319">319</a>
<a href="#L320">320</a>
<a href="#L321">321</a>
<a href="#L322">322</a>
<a href="#L323">323</a>
<a href="#L324">324</a>
<a href="#L325">325</a>
<a href="#L326">326</a>
<a href="#L327">327</a>
<a href="#L328">328</a>
<a href="#L329">329</a>
<a href="#L330">330</a>
<a href="#L331">331</a>
<a href="#L332">332</a>
<a href="#L333">333</a>
<a href="#L334">334</a>
<a href="#L335">335</a>
<a href="#L336">336</a>
<a href="#L337">337</a>
<a href="#L338">338</a>
<a href="#L339">339</a>
<a href="#L340">340</a>
<a href="#L341">341</a>
<a href="#L342">342</a>
<a href="#L343">343</a>
<a href="#L344">344</a>
<a href="#L345">345</a>
<a href="#L346">346</a>
<a href="#L347">347</a>
<a href="#L348">348</a>
<a href="#L349">349</a>
<a href="#L350">350</a>
<a href="#L351">351</a>
<a href="#L352">352</a>
<a href="#L353">353</a>
<a href="#L354">354</a>
<a href="#L355">355</a>
<a href="#L356">356</a>
<a href="#L357">357</a>
<a href="#L358">358</a>
<a href="#L359">359</a>
<a href="#L360">360</a>
<a href="#L361">361</a>
<a href="#L362">362</a>
<a href="#L363">363</a>
<a href="#L364">364</a>
<a href="#L365">365</a>
<a href="#L366">366</a>
<a href="#L367">367</a>
<a href="#L368">368</a>
<a href="#L369">369</a>
<a href="#L370">370</a>
<a href="#L371">371</a>
<a href="#L372">372</a>
<a href="#L373">373</a>
<a href="#L374">374</a>
<a href="#L375">375</a>
<a href="#L376">376</a>
<a href="#L377">377</a>
<a href="#L378">378</a>
<a href="#L379">379</a>
<a href="#L380">380</a>
<a href="#L381">381</a>
<a href="#L382">382</a>
<a href="#L383">383</a>
<a href="#L384">384</a>
<a href="#L385">385</a>
<a href="#L386">386</a>
<a href="#L387">387</a>
<a href="#L388">388</a>
<a href="#L389">389</a>
<a href="#L390">390</a>
<a href="#L391">391</a>
<a href="#L392">392</a>
<a href="#L393">393</a>
<a href="#L394">394</a>
<a href="#L395">395</a>
<a href="#L396">396</a>
<a href="#L397">397</a>
<a href="#L398">398</a>
<a href="#L399">399</a>
<a href="#L400">400</a>
<a href="#L401">401</a>
<a href="#L402">402</a>
<a href="#L403">403</a>
<a href="#L404">404</a>
<a href="#L405">405</a>
<a href="#L406">406</a>
<a href="#L407">407</a>
<a href="#L408">408</a>
<a href="#L409">409</a>
<a href="#L410">410</a>
<a href="#L411">411</a>
<a href="#L412">412</a>
<a href="#L413">413</a>
<a href="#L414">414</a>
<a href="#L415">415</a>
<a href="#L416">416</a>
<a href="#L417">417</a>
<a href="#L418">418</a>
<a href="#L419">419</a>
<a href="#L420">420</a>
<a href="#L421">421</a>
<a href="#L422">422</a>
<a href="#L423">423</a>
<a href="#L424">424</a>
<a href="#L425">425</a>
<a href="#L426">426</a>
<a href="#L427">427</a>
<a href="#L428">428</a>
<a href="#L429">429</a>
<a href="#L430">430</a>
<a href="#L431">431</a>
<a href="#L432">432</a>
<a href="#L433">433</a>
<a href="#L434">434</a>
<a href="#L435">435</a>
<a href="#L436">436</a>
<a href="#L437">437</a>
<a href="#L438">438</a>
<a href="#L439">439</a>
<a href="#L440">440</a>
<a href="#L441">441</a>
<a href="#L442">442</a>
<a href="#L443">443</a>
<a href="#L444">444</a>
<a href="#L445">445</a>
<a href="#L446">446</a>
<a href="#L447">447</a>
<a href="#L448">448</a>
<a href="#L449">449</a>
<a href="#L450">450</a>
<a href="#L451">451</a>
<a href="#L452">452</a>
<a href="#L453">453</a>
<a href="#L454">454</a>
<a href="#L455">455</a>
<a href="#L456">456</a>
<a href="#L457">457</a>
<a href="#L458">458</a>
<a href="#L459">459</a>
<a href="#L460">460</a>
<a href="#L461">461</a>
<a href="#L462">462</a>
<a href="#L463">463</a>
<a href="#L464">464</a>
<a href="#L465">465</a>
<a href="#L466">466</a>
<a href="#L467">467</a>
<a href="#L468">468</a>
<a href="#L469">469</a>
<a href="#L470">470</a>
<a href="#L471">471</a>
<a href="#L472">472</a>
<a href="#L473">473</a>
<a href="#L474">474</a>
<a href="#L475">475</a>
<a href="#L476">476</a>
<a href="#L477">477</a>
<a href="#L478">478</a>
<a href="#L479">479</a>
<a href="#L480">480</a>
<a href="#L481">481</a>
<a href="#L482">482</a>
<a href="#L483">483</a>
<a href="#L484">484</a>
<a href="#L485">485</a>
<a href="#L486">486</a>
<a href="#L487">487</a>
<a href="#L488">488</a>
<a href="#L489">489</a>
<a href="#L490">490</a>
<a href="#L491">491</a>
<a href="#L492">492</a>
<a href="#L493">493</a>
<a href="#L494">494</a>
<a href="#L495">495</a>
<a href="#L496">496</a>
<a href="#L497">497</a>
<a href="#L498">498</a>
<a href="#L499">499</a>
<a href="#L500">500</a>
<a href="#L501">501</a>
<a href="#L502">502</a>
<a href="#L503">503</a>
<a href="#L504">504</a>
<a href="#L505">505</a>
<a href="#L506">506</a>
<a href="#L507">507</a>
<a href="#L508">508</a>
<a href="#L509">509</a>
<a href="#L510">510</a>
<a href="#L511">511</a>
<a href="#L512">512</a>
<a href="#L513">513</a>
<a href="#L514">514</a>
<a href="#L515">515</a>
<a href="#L516">516</a>
<a href="#L517">517</a>
<a href="#L518">518</a>
<a href="#L519">519</a>
<a href="#L520">520</a>
<a href="#L521">521</a>
<a href="#L522">522</a>
<a href="#L523">523</a>
<a href="#L524">524</a>
<a href="#L525">525</a>
<a href="#L526">526</a>
<a href="#L527">527</a>
<a href="#L528">528</a>
<a href="#L529">529</a>
<a href="#L530">530</a>
<a href="#L531">531</a>
<a href="#L532">532</a>
<a href="#L533">533</a>
<a href="#L534">534</a>
<a href="#L535">535</a>
<a href="#L536">536</a>
<a href="#L537">537</a>
<a href="#L538">538</a>
<a href="#L539">539</a>
<a href="#L540">540</a>
<a href="#L541">541</a>
<a href="#L542">542</a>
<a href="#L543">543</a>
<a href="#L544">544</a>
<a href="#L545">545</a>
<a href="#L546">546</a>
<a href="#L547">547</a>
<a href="#L548">548</a>
<a href="#L549">549</a>
<a href="#L550">550</a>
<a href="#L551">551</a>
<a href="#L552">552</a>
<a href="#L553">553</a>
<a href="#L554">554</a>
<a href="#L555">555</a>
<a href="#L556">556</a>
<a href="#L557">557</a>
<a href="#L558">558</a>
<a href="#L559">559</a>
<a href="#L560">560</a>
<a href="#L561">561</a>
<a href="#L562">562</a>
<a href="#L563">563</a>
<a href="#L564">564</a>
<a href="#L565">565</a>
<a href="#L566">566</a>
<a href="#L567">567</a>
<a href="#L568">568</a>
<a href="#L569">569</a>
<a href="#L570">570</a>
<a href="#L571">571</a>
<a href="#L572">572</a>
<a href="#L573">573</a>
<a href="#L574">574</a>
<a href="#L575">575</a>
<a href="#L576">576</a>
<a href="#L577">577</a>
<a href="#L578">578</a>
<a href="#L579">579</a>
<a href="#L580">580</a>
<a href="#L581">581</a>
<a href="#L582">582</a>
<a href="#L583">583</a>
<a href="#L584">584</a>
<a href="#L585">585</a>
<a href="#L586">586</a>
<a href="#L587">587</a>
<a href="#L588">588</a>
<a href="#L589">589</a>
<a href="#L590">590</a>
<a href="#L591">591</a>
<a href="#L592">592</a>
<a href="#L593">593</a>
<a href="#L594">594</a>
<a href="#L595">595</a>
<a href="#L596">596</a>
<a href="#L597">597</a>
<a href="#L598">598</a>
<a href="#L599">599</a>
<a href="#L600">600</a>
<a href="#L601">601</a>
<a href="#L602">602</a>
<a href="#L603">603</a>
<a href="#L604">604</a>
<a href="#L605">605</a>
<a href="#L606">606</a>
<a href="#L607">607</a>
<a href="#L608">608</a>
<a href="#L609">609</a>
<a href="#L610">610</a>
<a href="#L611">611</a>
<a href="#L612">612</a>
<a href="#L613">613</a>
<a href="#L614">614</a>
<a href="#L615">615</a>
<a href="#L616">616</a>
<a href="#L617">617</a>
<a href="#L618">618</a>
<a href="#L619">619</a>
<a href="#L620">620</a>
<a href="#L621">621</a>
<a href="#L622">622</a>
<a href="#L623">623</a>
<a href="#L624">624</a>
<a href="#L625">625</a>
<a href="#L626">626</a>
<a href="#L627">627</a>
<a href="#L628">628</a>
<a href="#L629">629</a>
<a href="#L630">630</a>
<a href="#L631">631</a>
<a href="#L632">632</a>
<a href="#L633">633</a>
<a href="#L634">634</a>
<a href="#L635">635</a>
<a href="#L636">636</a>
<a href="#L637">637</a>
<a href="#L638">638</a>
<a href="#L639">639</a>
<a href="#L640">640</a>
<a href="#L641">641</a>
<a href="#L642">642</a>
<a href="#L643">643</a>
<a href="#L644">644</a>
<a href="#L645">645</a>
<a href="#L646">646</a>
<a href="#L647">647</a>
<a href="#L648">648</a>
<a href="#L649">649</a>
<a href="#L650">650</a>
<a href="#L651">651</a>
<a href="#L652">652</a>
<a href="#L653">653</a>
<a href="#L654">654</a>
<a href="#L655">655</a>
<a href="#L656">656</a>
<a href="#L657">657</a>
<a href="#L658">658</a>
<a href="#L659">659</a>
<a href="#L660">660</a>
<a href="#L661">661</a>
<a href="#L662">662</a>
<a href="#L663">663</a>
<a href="#L664">664</a>
<a href="#L665">665</a>
<a href="#L666">666</a>
<a href="#L667">667</a>
<a href="#L668">668</a>
<a href="#L669">669</a>
<a href="#L670">670</a>
<a href="#L671">671</a>
<a href="#L672">672</a>
<a href="#L673">673</a>
<a href="#L674">674</a>
<a href="#L675">675</a>
<a href="#L676">676</a>
<a href="#L677">677</a>
<a href="#L678">678</a>
<a href="#L679">679</a>
<a href="#L680">680</a>
<a href="#L681">681</a>
<a href="#L682">682</a>
<a href="#L683">683</a>
<a href="#L684">684</a>
<a href="#L685">685</a>
<a href="#L686">686</a>
<a href="#L687">687</a>
<a href="#L688">688</a>
<a href="#L689">689</a>
<a href="#L690">690</a>
<a href="#L691">691</a>
<a href="#L692">692</a>
<a href="#L693">693</a>
<a href="#L694">694</a>
<a href="#L695">695</a>
<a href="#L696">696</a>
<a href="#L697">697</a>
<a href="#L698">698</a>
<a href="#L699">699</a>
<a href="#L700">700</a>
<a href="#L701">701</a>
<a href="#L702">702</a>
<a href="#L703">703</a>
<a href="#L704">704</a>
<a href="#L705">705</a>
<a href="#L706">706</a>
<a href="#L707">707</a>
<a href="#L708">708</a>
<a href="#L709">709</a>
<a href="#L710">710</a>
<a href="#L711">711</a>
<a href="#L712">712</a>
<a href="#L713">713</a>
</pre>
<pre><code class="ocaml">(** Copyright 2024-2025, Karim Shakirov, Alexei Dmitrievtsev *)

(** SPDX-License-Identifier: MIT *)

open EvalMonad
open EvalMonad.Monad
open Ast
open Format

let rec pp_value = function
  | <span data-count="117">V</span>alue_int n -&gt; asprintf "%d" n
  | <span data-count="1">V</span>alue_bool b -&gt; asprintf "%b" b
  | <span data-count="0">V</span>alue_nil Nil -&gt; "&lt;nil&gt;"
  | <span data-count="1">V</span>alue_array (_, values) -&gt; asprintf "[%s]" (PpType.sep_by_comm<span data-count="1">a</span> values pp_value)
  | <span data-count="0">V</span>alue_chan chan -&gt;
    (match chan with
     | <span data-count="0">C</span>han_uninitialized Nil -&gt; "&lt;nil&gt;"
     | <span data-count="0">C</span>han_initialized id -&gt; asprintf "&lt;chan %d&gt;" id)
  | <span data-count="0">V</span>alue_func func -&gt;
    (match func with
     | <span data-count="0">F</span>unc_uninitialized Nil -&gt; "&lt;nil&gt;"
     | <span data-count="0">_</span> -&gt; "&lt;func&gt;")
  | <span data-count="107">V</span>alue_string s -&gt; s
  | <span data-count="1">V</span>alue_tuple values -&gt; PpType.sep_by_comma values pp_value
;;

let rpf lst = <span data-count="90">L</span>ist.map (fun (y, _) -&gt; <span data-count="71">y</span>) lst

(** Executes next statement, returns [Some ()] if there was statement to execute,
    and [None] if the end of current execution block was reached *)
let exec_stmt eval_stmt =
  <span data-count="587">p</span>op_next_statement
  &gt;&gt;= function
  | <span data-count="452">S</span>ome st -&gt; eval_stm<span data-count="452">t</span> st *&gt; retur<span data-count="452">n</span> (Some ())
  | <span data-count="139">N</span>one -&gt; return None
;;

let rec replace_list list index elem =
  <span data-count="102">m</span>atch list with
  | <span data-count="23">[</span>] -&gt; list
  | <span data-count="79">h</span> :: t -&gt;
    if index = 0
    then <span data-count="23">e</span>lem :: replace_lis<span data-count="23">t</span> t (index - 1) elem
    else <span data-count="56">h</span> :: replace_lis<span data-count="56">t</span> t (index - 1) elem
;;

(** Executes current execution block. Stops when its end reached, or when [return]
    statement was executed, when some chanel started to be used
    and when current goroutine is panicking *)
let rec exec eval_stmt =
  <span data-count="587">e</span>xec_stm<span data-count="587">t</span> eval_stmt
  &gt;&gt;= function
  | <span data-count="139">N</span>one -&gt; return ()
  | <span data-count="446">S</span>ome () -&gt;
    is_using_chanel
    &gt;&gt;= (function
     | <span data-count="4">S</span>ome _ -&gt; return ()
     | <span data-count="442">N</span>one -&gt;
       read_returns
       &gt;&gt;= (function
        | <span data-count="53">S</span>ome _ -&gt; return ()
        | <span data-count="389">N</span>one -&gt;
          read_panics
          &gt;&gt;= (function
           | <span data-count="16">S</span>ome _ -&gt; return ()
           | <span data-count="373">N</span>one -&gt; exec eval_stmt)))
;;

let rec skip_local_env (hd, tl) =
  <span data-count="6">m</span>atch hd.env_type with
  | <span data-count="2">F</span>or -&gt; return (hd :: tl)
  | <span data-count="4">D</span>efault -&gt;
    skip_local_en<span data-count="4">v</span> (List.h<span data-count="4">d</span> tl, List.t<span data-count="4">l</span> tl)
    &gt;&gt;= fun sk -&gt; <span data-count="4">r</span>eturn ({ hd with exec_block = [] } :: sk)
;;

(** Runs all ready to run goroutines, after it returns it is guaranteed that all existing goroutines
    are working with chanels. If main goroutine finishes executing here, the whole program finishes running *)
let run_ready_goroutines eval_stmt =
  <span data-count="55">l</span>et rec runner () =
    <span data-count="57">r</span>un_ready_goroutine
    &gt;&gt;= function
    | <span data-count="1">N</span>one -&gt; return ()
    | <span data-count="56">S</span>ome () -&gt;
      exe<span data-count="56">c</span> eval_stmt *<span data-count="56">&gt;</span> is_using_chanel
      &gt;&gt;= (function
       | <span data-count="4">S</span>ome _ -&gt;
         return ()
         (* chanel is being used, so we need to return to receiver to receive the value *)
       | <span data-count="46">N</span>one -&gt;
         (* goroutine finished executing *)
         (read_panics
          &gt;&gt;<span data-count="46">=</span> function
          | <span data-count="1">S</span>ome pnc -&gt; fail (Runtime_error (Panic (pp_valu<span data-count="1">e</span> (Value_tuple pnc))))
          | <span data-count="45">N</span>one -&gt; return ())
         *<span data-count="46">&gt;</span> read_running_fail
         &gt;&gt;= (function
          | <span data-count="43">{</span> go_id = 1; _ } -&gt;
            (* main goroutine finished working and doesn't wait for others to finish *)
            return ()
          | <span data-count="2">_</span> -&gt;
            (* some secondary goroutine finished working, don't stop until main finished *)
            delete_running_goroutine *&gt; runne<span data-count="2">r</span> ()))
  in
  runner ()
;;

(** [attempt_chan_interaction id] attempts to use chanel with given id. If both
    sender and receiver are ready, starts using the chanel. Doesn't do anything otherwise *)
let attempt_chan_interaction id inited_by =
  <span data-count="20">l</span>et* ready_to_send = is_send_queue_not_empt<span data-count="20">y</span> id in
  <span data-count="20">l</span>et* ready_to_receive = is_receive_queue_not_empt<span data-count="20">y</span> id in
  <span data-count="20">m</span>atch ready_to_send, ready_to_receive with
  | <span data-count="9">S</span>ome (), Some () -&gt;
    let* sending_goroutine, value = pop_from_send_queu<span data-count="9">e</span> id in
    <span data-count="9">l</span>et* receiving_goroutine = pop_from_receive_queu<span data-count="9">e</span> id in
    <span data-count="9">s</span>tart_using_chanel { sending_goroutine; receiving_goroutine; value; inited_by }
    (* receiving goroutine will run after return from a function *)
  | <span data-count="11">_</span> -&gt; return ()
;;

let rec eval_expr = function
  | <span data-count="239">E</span>xpr_const (Const_int n) -&gt; return (Value_int n)
  | <span data-count="113">E</span>xpr_const (Const_string s) -&gt; return (Value_string s)
  | <span data-count="4">E</span>xpr_const (Const_array (size, _, exprs)) -&gt;
    ma<span data-count="4">p</span> eval_expr exprs &gt;&gt;= fun values -&gt; <span data-count="4">r</span>eturn (Value_array (size, values))
  | <span data-count="10">E</span>xpr_const (Const_func afunc) -&gt;
    return (Value_func (Func_initialized (FuncLit, afunc)))
  | <span data-count="144">E</span>xpr_bin_oper (op, a1, a2) -&gt; eval_binop op a1 a2
  | <span data-count="11">E</span>xpr_un_oper (op, a) -&gt; eval_unop op a
  | <span data-count="912">E</span>xpr_ident id -&gt; read_ident id
  | <span data-count="30">E</span>xpr_index (array, index) -&gt; eval_index array index
  | <span data-count="67">E</span>xpr_call (func, args) -&gt;
    eval_exp<span data-count="67">r</span> func
    &gt;&gt;= (function
     | <span data-count="23">V</span>alue_func (Func_initialized (Closure _, afc)) -&gt;
       eval_closur<span data-count="23">e</span> (func, args)
       &gt;&gt;= fun (ret, vmp) -&gt;
       <span data-count="23">(</span>match func with
        | <span data-count="23">E</span>xpr_ident id -&gt;
          update_iden<span data-count="23">t</span> id (Value_func (Func_initialized (Closure vmp, afc)))
        | <span data-count="0">_</span> -&gt; retur<span data-count="0">n</span> ())
       *&gt;
         (match ret with
         | <span data-count="23">S</span>ome lst -&gt; retur<span data-count="23">n</span> lst
         | <span data-count="0">_</span> -&gt; fai<span data-count="0">l</span> (Runtime_error (TypeCheckFailed "expr")))
     | <span data-count="44">_</span> -&gt;
       eval_func_cal<span data-count="44">l</span> (func, args)
       &gt;&gt;= (function
        | <span data-count="44">S</span>ome lst -&gt; return lst
        | <span data-count="0">_</span> -&gt; fail (Runtime_error (TypeCheckFailed "expr"))))
  | <span data-count="9">E</span>xpr_chan_receive receive -&gt; eval_chan_receive receive

and eval_func_call (func, args) =
  <span data-count="230">e</span>val_exp<span data-count="230">r</span> func
  &gt;&gt;= function
  | <span data-count="0">V</span>alue_func (Func_uninitialized _) -&gt; fail (Runtime_error Uninited_func)
  | <span data-count="175">V</span>alue_func (Func_builtin ftype) -&gt; eval_builtin args ftype
  | <span data-count="50">V</span>alue_func (Func_initialized (Default, afc)) -&gt;
    create_args_ma<span data-count="50">p</span> args (rp<span data-count="50">f</span> afc.args)
    &gt;&gt;= fun map -&gt;
    <span data-count="50">a</span>dd_stack_fram<span data-count="50">e</span>
      { local_envs = { exec_block = afc.body; var_map = map; env_type = Default }, []
      ; deferred_funcs = []
      ; returns = None
      ; panics = None
      }
    *<span data-count="50">&gt;</span> exe<span data-count="50">c</span> eval_stmt
    *<span data-count="50">&gt;</span> read_returns
    &gt;&gt;= fun x -&gt;
    <span data-count="50">(</span>read_deferred &gt;&gt;<span data-count="50">=</span> ite<span data-count="50">r</span> eval_deferred_func) *<span data-count="50">&gt;</span> read_panics
    &gt;&gt;= fun panics -&gt; <span data-count="50">d</span>elete_stack_frame *<span data-count="50">&gt;</span> write_panic<span data-count="50">s</span> panics *&gt; retur<span data-count="50">n</span> x
  | <span data-count="5">V</span>alue_func (Func_initialized (FuncLit, afc)) -&gt;
    let* local_envs = read_local_envs &gt;&gt;<span data-count="5">=</span> fun (fl, lstl) -&gt; <span data-count="5">r</span>eturn (fl :: lstl) in
    <span data-count="5">c</span>reate_args_ma<span data-count="5">p</span> args (rp<span data-count="5">f</span> afc.args)
    &gt;&gt;= fun map -&gt;
    <span data-count="5">a</span>dd_stack_fram<span data-count="5">e</span>
      { local_envs =
          { exec_block = afc.body; var_map = map; env_type = Default }, local_envs
      ; deferred_funcs = []
      ; returns = None
      ; panics = None
      }
    *<span data-count="5">&gt;</span> exe<span data-count="5">c</span> eval_stmt
    *<span data-count="5">&gt;</span> read_returns
    &gt;&gt;= fun x -&gt;
    <span data-count="5">r</span>ead_local_envs
    &gt;&gt;= fun (_, lenv) -&gt;
    <span data-count="5">(</span>read_deferred &gt;&gt;<span data-count="5">=</span> ite<span data-count="5">r</span> eval_deferred_func) *<span data-count="5">&gt;</span> read_panics
    &gt;&gt;= fun panics -&gt;
    <span data-count="5">d</span>elete_stack_frame
    *<span data-count="5">&gt;</span> write_panic<span data-count="5">s</span> panics
    *<span data-count="5">&gt;</span> write_local_env<span data-count="5">s</span> (List.h<span data-count="5">d</span> lenv, List.t<span data-count="5">l</span> lenv)
    *&gt; retur<span data-count="5">n</span> x
  | <span data-count="0">_</span> -&gt; fail (Runtime_error (TypeCheckFailed "defer func_call"))

and eval_closure (func, args) =
  <span data-count="23">e</span>val_exp<span data-count="23">r</span> func
  &gt;&gt;= function
  | <span data-count="23">V</span>alue_func (Func_initialized (Closure vmap, afc)) -&gt;
    let* local_envs = read_local_envs &gt;&gt;<span data-count="23">=</span> fun (fl, lstl) -&gt; <span data-count="23">r</span>eturn (fl :: lstl) in
    <span data-count="23">c</span>reate_args_ma<span data-count="23">p</span> args (rp<span data-count="23">f</span> afc.args)
    &gt;&gt;= fun map -&gt;
    <span data-count="23">a</span>dd_stack_fram<span data-count="23">e</span>
      { local_envs =
          ( { exec_block = afc.body; var_map = map; env_type = Default }
          , { exec_block = []; var_map = vmap; env_type = Default } :: local_envs )
      ; deferred_funcs = []
      ; returns = None
      ; panics = None
      }
    *<span data-count="23">&gt;</span> exe<span data-count="23">c</span> eval_stmt
    *<span data-count="23">&gt;</span> read_panics
    &gt;&gt;= fun panics -&gt;
    <span data-count="23">w</span>rite_panic<span data-count="23">s</span> panics *<span data-count="23">&gt;</span> read_returns
    &gt;&gt;= fun x -&gt;
    <span data-count="23">r</span>ead_local_envs
    &gt;&gt;= fun (_, lenv) -&gt;
    <span data-count="23">(</span>read_deferred &gt;&gt;<span data-count="23">=</span> ite<span data-count="23">r</span> eval_deferred_func) *<span data-count="23">&gt;</span> read_panics
    &gt;&gt;= fun panics -&gt;
    <span data-count="23">d</span>elete_stack_frame
    *<span data-count="23">&gt;</span> write_panic<span data-count="23">s</span> panics
    *<span data-count="23">&gt;</span> write_local_env<span data-count="23">s</span> (List.h<span data-count="23">d</span> (List.t<span data-count="23">l</span> lenv), List.t<span data-count="23">l</span> (List.t<span data-count="23">l</span> lenv))
    *&gt; retur<span data-count="23">n</span> (x, (List.h<span data-count="23">d</span> lenv).var_map)
  | <span data-count="0">_</span> -&gt; fail (Runtime_error (TypeCheckFailed "closure_call"))

and eval_deferred_func (vfunc, vargs) =
  <span data-count="16">m</span>atch vfunc with
  | <span data-count="0">V</span>alue_func (Func_uninitialized _) -&gt; fai<span data-count="0">l</span> (Runtime_error Uninited_func) *&gt; retur<span data-count="0">n</span> ()
  | <span data-count="13">V</span>alue_func (Func_builtin ftype) -&gt; prepare_builtin_eva<span data-count="13">l</span> vargs ftype *&gt; retur<span data-count="13">n</span> ()
  | <span data-count="0">V</span>alue_func (Func_initialized (Default, afc)) -&gt;
    let rec save_args map = function
      | <span data-count="0">[</span>] -&gt; return map
      | <span data-count="0">(</span>vl, id) :: tl -&gt; save_args (MapIdent.ad<span data-count="0">d</span> id vl map) tl
    in
    let* panics = read_panics in
    <span data-count="0">s</span>ave_arg<span data-count="0">s</span> MapIdent.empty (List.combin<span data-count="0">e</span> vargs (rp<span data-count="0">f</span> afc.args))
    &gt;&gt;= fun map -&gt;
    <span data-count="0">a</span>dd_stack_fram<span data-count="0">e</span>
      { local_envs = { exec_block = afc.body; var_map = map; env_type = Default }, []
      ; deferred_funcs = []
      ; returns = None
      ; panics
      }
    *<span data-count="0">&gt;</span> exe<span data-count="0">c</span> eval_stmt
    *<span data-count="0">&gt;</span> read_returns
    *<span data-count="0">&gt;</span> read_panics
    &gt;&gt;= fun panics -&gt; <span data-count="0">d</span>elete_stack_frame *<span data-count="0">&gt;</span> write_panic<span data-count="0">s</span> panics *&gt; retur<span data-count="0">n</span> ()
  | <span data-count="3">V</span>alue_func (Func_initialized (FuncLit, afc)) -&gt;
    let* local_envs = read_local_envs &gt;&gt;<span data-count="3">=</span> fun (fl, lstl) -&gt; <span data-count="3">r</span>eturn (fl :: lstl) in
    <span data-count="3">l</span>et rec save_args map = function
      | <span data-count="3">[</span>] -&gt; return map
      | <span data-count="0">(</span>vl, id) :: tl -&gt; save_args (MapIdent.ad<span data-count="0">d</span> id vl map) tl
    in
    let* panics = read_panics in
    <span data-count="3">s</span>ave_arg<span data-count="3">s</span> MapIdent.empty (List.combin<span data-count="3">e</span> vargs (rp<span data-count="3">f</span> afc.args))
    &gt;&gt;= fun map -&gt;
    <span data-count="3">a</span>dd_stack_fram<span data-count="3">e</span>
      { local_envs =
          { exec_block = afc.body; var_map = map; env_type = Default }, local_envs
      ; deferred_funcs = []
      ; returns = None
      ; panics
      }
    *<span data-count="3">&gt;</span> exe<span data-count="3">c</span> eval_stmt
    *<span data-count="3">&gt;</span> read_returns
    *<span data-count="3">&gt;</span> read_local_envs
    &gt;&gt;= fun (_, lenv) -&gt;
    <span data-count="3">r</span>ead_panics
    &gt;&gt;= fun panics -&gt;
    <span data-count="3">d</span>elete_stack_frame
    *<span data-count="3">&gt;</span> write_panic<span data-count="3">s</span> panics
    *<span data-count="3">&gt;</span> write_local_env<span data-count="3">s</span> (List.h<span data-count="3">d</span> lenv, List.t<span data-count="3">l</span> lenv)
    *&gt; retur<span data-count="3">n</span> ()
  | <span data-count="0">_</span> -&gt; fail (Runtime_error (TypeCheckFailed "func_call"))

and retrieve_arg_value = function
  | <span data-count="313">A</span>rg_expr e -&gt; eval_expr e
  | <span data-count="0">A</span>rg_type _ -&gt; fail (Runtime_error (TypeCheckFailed "arg_value"))

and create_args_map args idents =
  <span data-count="87">l</span>et rec save_args map = function
    | <span data-count="87">[</span>] -&gt; return map
    | <span data-count="71">(</span>expr, id) :: tl -&gt;
      retrieve_arg_valu<span data-count="71">e</span> expr &gt;&gt;= fun vl -&gt; <span data-count="71">s</span>ave_args (MapIdent.ad<span data-count="71">d</span> id vl map) tl
  in
  save_args MapIdent.empty (List.combin<span data-count="87">e</span> args idents)

and eval_builtin args func =
  <span data-count="175">m</span>atch func with
  | <span data-count="8">M</span>ake -&gt; prepare_builtin_eval [] Make
  | <span data-count="167">_</span> -&gt; ma<span data-count="167">p</span> retrieve_arg_value args &gt;&gt;= fun vlst -&gt; <span data-count="166">p</span>repare_builtin_eval vlst func

and prepare_builtin_eval vlist = function
  | <span data-count="40">P</span>rint -&gt;
    let list = List.map pp_value vlist in
    <span data-count="40">r</span>etur<span data-count="40">n</span> (print_strin<span data-count="40">g</span> (String.conca<span data-count="40">t</span> " " list)) *&gt; retur<span data-count="40">n</span> None
  | <span data-count="116">P</span>rintln -&gt;
    let list = List.map pp_value vlist in
    <span data-count="116">r</span>etur<span data-count="116">n</span> (print_strin<span data-count="116">g</span> (String.conca<span data-count="116">t</span> " " list ^ "\n")) *&gt; retur<span data-count="116">n</span> None
  | <span data-count="8">M</span>ake -&gt;
    let* chan_id = create_chanel in
    <span data-count="8">r</span>eturn (Some (Value_chan (Chan_initialized chan_id)))
  | <span data-count="1">C</span>lose -&gt;
    (match vlist with
     | <span data-count="1">[</span> Value_chan chan ] -&gt; close_chane<span data-count="1">l</span> chan *&gt; retur<span data-count="1">n</span> None
     | <span data-count="0">_</span> -&gt; fail (Runtime_error (TypeCheckFailed "close")))
  | <span data-count="17">L</span>en -&gt;
    (match vlist with
     | <span data-count="16">[</span> Value_array (len, _) ] -&gt; return (Some (Value_int len))
     | <span data-count="1">[</span> Value_string s ] -&gt; return (Some (Value_int (String.lengt<span data-count="1">h</span> s)))
     | <span data-count="0">_</span> -&gt; fail (Runtime_error (TypeCheckFailed "len")))
  | <span data-count="3">P</span>anic -&gt; write_panic<span data-count="3">s</span> (Some vlist) *&gt; retur<span data-count="3">n</span> None
  | <span data-count="2">R</span>ecover -&gt;
    read_panics
    &gt;&gt;= fun pnc -&gt;
    <span data-count="2">w</span>rite_panic<span data-count="2">s</span> None
    *&gt;
      (match pnc with
      | <span data-count="2">S</span>ome [ single_srg ] -&gt; retur<span data-count="2">n</span> (Some single_srg)
      | <span data-count="0">S</span>ome lst -&gt; retur<span data-count="0">n</span> (Some (Value_tuple lst))
      | <span data-count="0">N</span>one -&gt; retur<span data-count="0">n</span> (Some (Value_nil Nil)))

and eval_index array index =
  <span data-count="30">l</span>et* array = eval_exp<span data-count="30">r</span> array in
  <span data-count="29">l</span>et* index = eval_exp<span data-count="29">r</span> index in
  <span data-count="29">m</span>atch array, index with
  | <span data-count="29">V</span>alue_array (_, values), Value_int index -&gt;
    (try retur<span data-count="28">n</span> (List.nt<span data-count="28">h</span> values index) with
     | <span data-count="0">I</span>nvalid_argument _ -&gt; fail (Runtime_error Negative_array_index)
     | <span data-count="1">F</span>ailure _ -&gt; fail (Runtime_error Array_index_out_of_bound))
  | <span data-count="0">_</span> -&gt; fail (Runtime_error (TypeCheckFailed "index"))

and eval_unop op expr =
  <span data-count="11">l</span>et* value = eval_exp<span data-count="11">r</span> expr in
  <span data-count="11">m</span>atch op, value with
  | <span data-count="11">U</span>nary_minus, Value_int a -&gt; return (Value_int (<span data-count="11">-</span>a))
  | <span data-count="0">U</span>nary_plus, Value_int a -&gt; return (Value_int a)
  | <span data-count="0">U</span>nary_not, Value_bool a -&gt; return (Value_bool (not a))
  | <span data-count="0">_</span> -&gt; fail (Runtime_error (TypeCheckFailed "unop"))

and eval_equal = function
  | <span data-count="0">V</span>alue_nil Nil, Value_nil Nil
  | <span data-count="0">V</span>alue_nil Nil, Value_func (Func_uninitialized Nil)
  | <span data-count="0">V</span>alue_nil Nil, Value_chan (Chan_uninitialized Nil)
  | <span data-count="0">V</span>alue_func (Func_uninitialized Nil), Value_nil Nil
  | <span data-count="0">V</span>alue_chan (Chan_uninitialized Nil), Value_nil Nil -&gt; true
  | <span data-count="0">V</span>alue_nil Nil, _ | <span data-count="1">_</span>, Value_nil Nil -&gt; false
  | <span data-count="29">v</span>1, v2 -&gt; v1 = v2

and eval_binop op a1 a2 =
  <span data-count="144">l</span>et* a1 = eval_exp<span data-count="144">r</span> a1 in
  <span data-count="192">l</span>et* a2 = eval_exp<span data-count="192">r</span> a2 in
  <span data-count="192">m</span>atch op, a1, a2 with
  | <span data-count="54">B</span>in_sum, Value_int a1, Value_int a2 -&gt; return (Value_int (a1 + a2))
  | <span data-count="8">B</span>in_subtract, Value_int a1, Value_int a2 -&gt; return (Value_int (a1 - a2))
  | <span data-count="18">B</span>in_multiply, Value_int a1, Value_int a2 -&gt; return (Value_int (a1 * a2))
  | <span data-count="1">B</span>in_divide, Value_int a1, Value_int a2 -&gt;
    (try retur<span data-count="0">n</span> (Value_int (a1 / a2)) with
     | <span data-count="1">D</span>ivision_by_zero -&gt; fail (Runtime_error Division_by_0))
  | <span data-count="1">B</span>in_modulus, Value_int a1, Value_int a2 -&gt;
    (try retur<span data-count="0">n</span> (Value_int (a1 mod a2)) with
     | <span data-count="1">D</span>ivision_by_zero -&gt; fail (Runtime_error Division_by_0))
  | <span data-count="0">B</span>in_and, Value_bool a1, Value_bool a2 -&gt; return (Value_bool (a1 &amp;&amp; <span data-count="0">a</span>2))
  | <span data-count="0">B</span>in_or, Value_bool a1, Value_bool a2 -&gt; return (Value_bool (a<span data-count="0">1</span> || a<span data-count="0">2</span>))
  | <span data-count="29">B</span>in_equal, a1, a2 -&gt; return (Value_bool (eval_equa<span data-count="29">l</span> (a1, a2)))
  | <span data-count="1">B</span>in_not_equal, a1, a2 -&gt; return (Value_bool (not (eval_equa<span data-count="1">l</span> (a1, a2))))
  | <span data-count="58">B</span>in_less, Value_int a1, Value_int a2 -&gt; return (Value_bool (a1 &lt; a2))
  | <span data-count="4">B</span>in_less_equal, Value_int a1, Value_int a2 -&gt; return (Value_bool (a1 &lt;= a2))
  | <span data-count="16">B</span>in_greater, Value_int a1, Value_int a2 -&gt; return (Value_bool (a1 &gt; a2))
  | <span data-count="2">B</span>in_greater_equal, Value_int a1, Value_int a2 -&gt; return (Value_bool (a1 &gt;= a2))
  | <span data-count="0">_</span> -&gt; fail (Runtime_error (TypeCheckFailed "binop"))

and update_lvalue value = function
  | <span data-count="38">L</span>value_ident id -&gt; update_ident id value
  | <span data-count="9">l</span>value -&gt;
    let* lvalue_value, indicies = collect_lvalue_indicie<span data-count="9">s</span> [] lvalue in
    <span data-count="9">l</span>et* new_lvalue = change_lvalue_inde<span data-count="9">x</span> lvalue_value indicies value in
    <span data-count="8">u</span>pdate_ident (retrieve_lvalue_iden<span data-count="8">t</span> lvalue) new_lvalue

and collect_lvalue_indicies acc = function
  | <span data-count="9">L</span>value_ident id -&gt;
    let* lvalue_value = read_iden<span data-count="9">t</span> id in
    <span data-count="9">r</span>eturn (lvalue_value, acc)
  | <span data-count="27">L</span>value_array_index (array, index) -&gt;
    eval_exp<span data-count="27">r</span> index
    &gt;&gt;= (function
     | <span data-count="27">V</span>alue_int i -&gt; collect_lvalue_indicies (i :: acc) array
     | <span data-count="0">_</span> -&gt; fail (Runtime_error (TypeCheckFailed "prepare lvalue")))

and retrieve_lvalue_ident = function
  | <span data-count="8">L</span>value_ident id -&gt; id
  | <span data-count="23">L</span>value_array_index (lv, _) -&gt; retrieve_lvalue_ident lv

and change_lvalue_index target indicies value =
  <span data-count="26">m</span>atch target with
  | <span data-count="26">V</span>alue_array (size, values) -&gt;
    (match indicies with
     | <span data-count="8">[</span> i ] -&gt; return (Value_array (i, replace_lis<span data-count="8">t</span> values i value))
     | <span data-count="18">_</span> -&gt;
       (try
          change_lvalue_inde<span data-count="17">x</span>
            (List.nt<span data-count="17">h</span> values (List.h<span data-count="18">d</span> indicies))
            (List.t<span data-count="18">l</span> indicies)
            value
          &gt;&gt;<span data-count="17">=</span> fun ls -&gt;
          <span data-count="15">r</span>eturn (Value_array (size, replace_lis<span data-count="15">t</span> values (List.h<span data-count="15">d</span> indicies) ls))
        with
        | <span data-count="1">F</span>ailure _ -&gt; fail (Runtime_error Array_index_out_of_bound)
        | <span data-count="0">I</span>nvalid_argument _ -&gt; fail (Runtime_error Negative_array_index)))
  | <span data-count="0">_</span> -&gt; return target

and eval_init = function
  | <span data-count="57">S</span>ome init -&gt;
    (match init with
     | <span data-count="0">I</span>nit_assign asgn -&gt; eval_stmt (Stmt_assign asgn)
     | <span data-count="0">I</span>nit_call call -&gt; eval_stmt (Stmt_call call)
     | <span data-count="11">I</span>nit_decl decl -&gt; eval_stmt (Stmt_short_var_decl decl)
     | <span data-count="0">I</span>nit_decr decr -&gt; eval_stmt (Stmt_decr decr)
     | <span data-count="46">I</span>nit_incr incr -&gt; eval_stmt (Stmt_incr incr)
     | <span data-count="0">I</span>nit_receive recv -&gt; eval_chan_receiv<span data-count="0">e</span> recv *&gt; retur<span data-count="0">n</span> ()
     | <span data-count="0">I</span>nit_send send -&gt; eval_chan_send send)
  | <span data-count="58">N</span>one -&gt; return ()

and eval_stmt = function
  | <span data-count="186">S</span>tmt_call call -&gt; eval_stmt_call call
  | <span data-count="17">S</span>tmt_long_var_decl lvd -&gt; eval_long_var_decl save_local_id lvd
  | <span data-count="0">S</span>tmt_decr id -&gt;
    read_iden<span data-count="0">t</span> id
    &gt;&gt;= (function
     | <span data-count="0">V</span>alue_int v -&gt; update_iden<span data-count="0">t</span> id (Value_int (v - 1)) *&gt; retur<span data-count="0">n</span> ()
     | <span data-count="0">_</span> -&gt; fail (Runtime_error (TypeCheckFailed "stmt")))
  | <span data-count="62">S</span>tmt_incr id -&gt;
    read_iden<span data-count="62">t</span> id
    &gt;&gt;= (function
     | <span data-count="62">V</span>alue_int v -&gt; update_iden<span data-count="62">t</span> id (Value_int (v + 1)) *&gt; retur<span data-count="62">n</span> ()
     | <span data-count="0">_</span> -&gt; fail (Runtime_error (TypeCheckFailed "stmt")))
  | <span data-count="47">S</span>tmt_assign asgn -&gt; eval_assign asgn
  | <span data-count="51">S</span>tmt_short_var_decl decl -&gt; eval_short_var_decl decl
  | <span data-count="54">S</span>tmt_if if' -&gt; eval_if if'
  | <span data-count="9">S</span>tmt_go call -&gt; eval_go call
  | <span data-count="0">S</span>tmt_block body -&gt; add_en<span data-count="0">v</span> body Default *<span data-count="0">&gt;</span> exe<span data-count="0">c</span> eval_stmt *&gt; delete_env
  | <span data-count="2">S</span>tmt_break -&gt; exe<span data-count="2">c</span> eval_stmt *&gt; delete_env
  | <span data-count="2">S</span>tmt_continue -&gt;
    (read_local_envs
     &gt;&gt;<span data-count="2">=</span> skip_local_env
     &gt;&gt;<span data-count="2">=</span> fun lst -&gt; <span data-count="2">w</span>rite_local_envs (List.h<span data-count="2">d</span> lst, List.t<span data-count="2">l</span> lst))
    *&gt; retur<span data-count="2">n</span> ()
  | <span data-count="11">S</span>tmt_for for' -&gt; eval_for for'
  | <span data-count="42">S</span>tmt_return exprs -&gt; eval_return exprs
  | <span data-count="10">S</span>tmt_chan_send send -&gt; eval_chan_send send
  | <span data-count="1">S</span>tmt_chan_receive recv -&gt; eval_chan_receiv<span data-count="1">e</span> recv *&gt; retur<span data-count="1">n</span> ()
  | <span data-count="16">S</span>tmt_defer (func, args) -&gt;
    eval_exp<span data-count="16">r</span> func
    &gt;&gt;= fun func_value -&gt;
    <span data-count="16">m</span>a<span data-count="16">p</span> retrieve_arg_value args &gt;&gt;= fun arg_values -&gt; <span data-count="16">a</span>dd_deferred (func_value, arg_values)

and eval_stmt_call (func, args) =
  <span data-count="186">e</span>val_exp<span data-count="186">r</span> func
  &gt;&gt;= function
  | <span data-count="0">V</span>alue_func (Func_initialized (Closure _, afc)) -&gt;
    eval_closur<span data-count="0">e</span> (func, args)
    &gt;&gt;= fun (_, vmp) -&gt;
    <span data-count="0">(</span>match func with
     | <span data-count="0">E</span>xpr_ident id -&gt; update_ident id (Value_func (Func_initialized (Closure vmp, afc)))
     | <span data-count="0">_</span> -&gt; return ())
  | <span data-count="186">_</span> -&gt; eval_func_cal<span data-count="186">l</span> (func, args) *&gt; retur<span data-count="186">n</span> ()

and eval_short_var_decl = function
  | <span data-count="51">S</span>hort_decl_mult_init (sfirst, lst) -&gt;
    iter (fun (ident, expr) -&gt; <span data-count="52">e</span>val_exp<span data-count="52">r</span> expr &gt;&gt;= save_local_i<span data-count="52">d</span> ident) (sfirst :: lst)
  | <span data-count="0">S</span>hort_decl_one_init (idnt1, idnt2, idntlst, fcall) -&gt;
    eval_func_cal<span data-count="0">l</span> fcall
    &gt;&gt;= (function
     | <span data-count="0">S</span>ome (Value_tuple tup) -&gt; iter2 save_local_id (idnt1 :: idnt2 :: idntlst) tup
     | <span data-count="0">_</span> -&gt; fail (Runtime_error (TypeCheckFailed "short decl")))

and eval_if { if_init; if_cond; if_body; else_body } =
  <span data-count="54">e</span>val_ini<span data-count="54">t</span> if_init *<span data-count="54">&gt;</span> eval_exp<span data-count="54">r</span> if_cond
  &gt;&gt;= function
  | <span data-count="15">V</span>alue_bool true -&gt; add_en<span data-count="15">v</span> if_body Default *<span data-count="15">&gt;</span> exe<span data-count="15">c</span> eval_stmt *&gt; delete_env
  | <span data-count="39">V</span>alue_bool false -&gt;
    (match else_body with
     | <span data-count="10">S</span>ome (Else_block body) -&gt; add_en<span data-count="10">v</span> body Default *<span data-count="10">&gt;</span> exe<span data-count="10">c</span> eval_stmt *&gt; delete_env
     | <span data-count="1">S</span>ome (Else_if if') -&gt; eval_stmt (Stmt_if if')
     | <span data-count="28">N</span>one -&gt; return ())
  | <span data-count="0">_</span> -&gt; fail (Runtime_error (TypeCheckFailed "if"))

and eval_long_var_decl save_to_env = function
  | <span data-count="24">L</span>ong_decl_mult_init (_, hd, tl) -&gt;
    iter (fun (ident, expr) -&gt; <span data-count="26">e</span>val_exp<span data-count="26">r</span> expr &gt;&gt;= save_to_en<span data-count="26">v</span> ident) (hd :: tl)
  | <span data-count="0">L</span>ong_decl_one_init (_, idnt1, idnt2, idntlst, fcall) -&gt;
    eval_func_cal<span data-count="0">l</span> fcall
    &gt;&gt;= (function
     | <span data-count="0">S</span>ome (Value_tuple tup) -&gt; iter2 save_to_env (idnt1 :: idnt2 :: idntlst) tup
     | <span data-count="0">_</span> -&gt; fail (Runtime_error (TypeCheckFailed "short decl")))
  | <span data-count="5">L</span>ong_decl_no_init (typ, id, id_list) -&gt;
    iter (fun idnt -&gt; <span data-count="5">s</span>ave_to_env idnt (default_ini<span data-count="5">t</span> typ)) (id :: id_list)

and eval_assign = function
  | <span data-count="47">A</span>ssign_mult_expr (fst, lst) -&gt;
    iter
      (fun (lvalue, expr) -&gt; <span data-count="47">e</span>val_exp<span data-count="47">r</span> expr &gt;&gt;= fun ex -&gt; <span data-count="47">u</span>pdate_lvalue ex lvalue)
      (fst :: lst)
  | <span data-count="0">A</span>ssign_one_expr (fst, snd, lst, fcall) -&gt;
    eval_func_cal<span data-count="0">l</span> fcall
    &gt;&gt;= (function
     | <span data-count="0">S</span>ome (Value_tuple tup) -&gt;
       iter2 (fun v lv -&gt; <span data-count="0">u</span>pdate_lvalu<span data-count="0">e</span> v lv *&gt; retur<span data-count="0">n</span> ()) tup (fst :: snd :: lst)
     | <span data-count="0">_</span> -&gt; fail (Runtime_error (TypeCheckFailed "short decl")))

and eval_for { for_init; for_cond; for_post; for_body } =
  <span data-count="11">l</span>et one_iter =
    match for_cond with
    | <span data-count="10">S</span>ome cond -&gt;
      eval_exp<span data-count="10">r</span> cond
      &gt;&gt;<span data-count="10">=</span> (function
       | <span data-count="49">V</span>alue_bool true -&gt;
         add_en<span data-count="49">v</span> for_body Default
         *<span data-count="49">&gt;</span> exe<span data-count="49">c</span> eval_stmt
         *<span data-count="49">&gt;</span> eval_ini<span data-count="49">t</span> for_post
         *<span data-count="49">&gt;</span> delete_env
         *&gt; retur<span data-count="49">n</span> true
       | <span data-count="9">V</span>alue_bool false -&gt; delete_env *&gt; retur<span data-count="9">n</span> false
       | <span data-count="0">_</span> -&gt; fail (Runtime_error (TypeCheckFailed "for cond")))
    | <span data-count="1">N</span>one -&gt;
      add_en<span data-count="1">v</span> for_body Default
      *<span data-count="1">&gt;</span> exe<span data-count="1">c</span> eval_stmt
      *<span data-count="1">&gt;</span> eval_ini<span data-count="1">t</span> for_post
      *<span data-count="1">&gt;</span> delete_env
      *<span data-count="1">&gt;</span> retur<span data-count="1">n</span> true
  in
  let rec cycle rfor =
    <span data-count="63">r</span>for
    &gt;&gt;= function
    | <span data-count="54">t</span>rue -&gt;
      read_local_envs
      &gt;&gt;= fun ({ env_type; _ }, _) -&gt;
      <span data-count="54">(</span>match env_type with
       | <span data-count="52">F</span>or -&gt; cycle rfor
       | <span data-count="2">D</span>efault -&gt; return ())
    | <span data-count="9">f</span>alse -&gt; return ()
  in
  add_en<span data-count="11">v</span> [] For *<span data-count="11">&gt;</span> eval_ini<span data-count="11">t</span> for_init *&gt; cycl<span data-count="11">e</span> one_iter

and eval_return = function
  | <span data-count="3">[</span> Expr_const (Const_func afc) ] -&gt;
    read_local_envs
    &gt;&gt;<span data-count="3">=</span> (fun (hd, _) -&gt; <span data-count="3">r</span>eturn (Value_func (Func_initialized (Closure hd.var_map, afc))))
    &gt;&gt;= fun vfun -&gt; <span data-count="3">w</span>rite_returns (Some vfun)
  | <span data-count="37">[</span> expr ] -&gt; eval_exp<span data-count="37">r</span> expr &gt;&gt;= fun ret -&gt; <span data-count="37">w</span>rite_returns (Some ret)
  | <span data-count="2">e</span>xprs -&gt;
    ma<span data-count="2">p</span> eval_expr exprs &gt;&gt;= fun values -&gt; <span data-count="2">w</span>rite_returns (Some (Value_tuple values))

and default_init = function
  | <span data-count="6">T</span>ype_int -&gt; Value_int 0
  | <span data-count="0">T</span>ype_bool -&gt; Value_bool false
  | <span data-count="360">T</span>ype_string -&gt; Value_string ""
  | <span data-count="0">T</span>ype_func _ -&gt; Value_func (Func_uninitialized Nil)
  | <span data-count="0">T</span>ype_chan _ -&gt; Value_chan (Chan_uninitialized Nil)
  | <span data-count="100">T</span>ype_array (size, t) -&gt; Value_array (size, List.ini<span data-count="100">t</span> size (fun _ -&gt; <span data-count="461">d</span>efault_init t))

and eval_chan_send (ident, expr) =
  <span data-count="10">l</span>et* value = eval_exp<span data-count="10">r</span> expr in
  <span data-count="10">r</span>ead_iden<span data-count="10">t</span> ident
  &gt;&gt;= function
  | <span data-count="10">V</span>alue_chan chan -&gt;
    let* chan_id = find_chanel_fai<span data-count="10">l</span> chan in
    <span data-count="10">l</span>et* sending_goroutine = read_running_fail in
    <span data-count="10">d</span>elete_running_goroutine
    *<span data-count="10">&gt;</span> push_to_send_queu<span data-count="10">e</span> chan_id sending_goroutine value
    *<span data-count="10">&gt;</span> attempt_chan_interactio<span data-count="10">n</span> chan_id Sender
    *&gt; (is_using_chanel
        &gt;&gt;<span data-count="10">=</span> function
        | <span data-count="4">S</span>ome _ -&gt; return ()
        | <span data-count="6">N</span>one -&gt;
          check_ready_goroutine
          &gt;&gt;= (function
           | <span data-count="1">N</span>one -&gt;
             fail
               (Runtime_error
                  (Deadlock
                     (asprint<span data-count="1">f</span>
                        "goroutine %d trying to send to chan %d"
                        sending_goroutine.go_id
                        chan_id)))
           | <span data-count="5">S</span>ome _ -&gt; run_ready_goroutines eval_stmt))
  | <span data-count="0">_</span> -&gt; fail (Runtime_error (TypeCheckFailed "chan send"))

and eval_chan_receive expr =
  <span data-count="10">e</span>val_exp<span data-count="10">r</span> expr
  &gt;&gt;= function
  | <span data-count="10">V</span>alue_chan chan -&gt;
    let* chan_id = find_chanel_fai<span data-count="10">l</span> chan in
    <span data-count="10">l</span>et* receiving_goroutine = read_running_fail in
    <span data-count="10">d</span>elete_running_goroutine
    *<span data-count="10">&gt;</span> push_to_receive_queu<span data-count="10">e</span> chan_id receiving_goroutine
    *<span data-count="10">&gt;</span> attempt_chan_interactio<span data-count="10">n</span> chan_id Receiver
    *<span data-count="10">&gt;</span> (is_using_chanel
        &gt;&gt;<span data-count="10">=</span> function
        | <span data-count="5">S</span>ome _ -&gt; return ()
        | <span data-count="5">N</span>one -&gt;
          run_ready_goroutine<span data-count="5">s</span> eval_stmt *<span data-count="5">&gt;</span> is_using_chanel
          &gt;&gt;= (function
           | <span data-count="4">S</span>ome _ -&gt; return ()
           | <span data-count="1">N</span>one -&gt;
             fail
               (Runtime_error
                  (Deadlock
                     (asprint<span data-count="1">f</span>
                        "goroutine %d trying to receive from chan %d"
                        receiving_goroutine.go_id
                        chan_id)))))
    *&gt;
    let* { receiving_goroutine; sending_goroutine; value; inited_by } = use_chanel in
    <span data-count="9">(</span>match inited_by with
     | <span data-count="5">R</span>eceiver -&gt;
       add_read<span data-count="5">y</span> sending_goroutine *<span data-count="5">&gt;</span> run_goroutin<span data-count="5">e</span> receiving_goroutine *&gt; retur<span data-count="5">n</span> value
     | <span data-count="4">S</span>ender -&gt; run_goroutin<span data-count="4">e</span> receiving_goroutine *&gt; retur<span data-count="4">n</span> value)
  | <span data-count="0">_</span> -&gt; fail (Runtime_error (TypeCheckFailed "chan receive"))

and eval_go (func, arg_exprs) =
  <span data-count="9">e</span>val_exp<span data-count="9">r</span> func
  &gt;&gt;= function
  | <span data-count="0">V</span>alue_func (Func_uninitialized Nil) -&gt; fail (Runtime_error Uninited_func)
  | <span data-count="0">V</span>alue_func (Func_builtin _) -&gt; eval_func_cal<span data-count="0">l</span> (func, arg_exprs) *&gt; retur<span data-count="0">n</span> ()
  | <span data-count="8">V</span>alue_func (Func_initialized (Default, { args; body; _ }))
  | <span data-count="1">V</span>alue_func (Func_initialized (FuncLit, { args; body; _ })) -&gt;
    let* var_map = create_args_ma<span data-count="9">p</span> arg_exprs (rp<span data-count="9">f</span> args) in
    <span data-count="9">c</span>reate_goroutine
      { local_envs = { exec_block = body; var_map; env_type = Default }, []
      ; deferred_funcs = []
      ; returns = None
      ; panics = None
      }
  | <span data-count="0">V</span>alue_func (Func_initialized (Closure closure_map, { args; body; _ })) -&gt;
    let* var_map = create_args_ma<span data-count="0">p</span> arg_exprs (rp<span data-count="0">f</span> args) in
    <span data-count="0">l</span>et var_map = MapIdent.union (fun _key v1 _v2 -&gt; <span data-count="0">S</span>ome v1) var_map closure_map in
    <span data-count="0">c</span>reate_goroutine
      { local_envs = { exec_block = body; var_map; env_type = Default }, []
      ; deferred_funcs = []
      ; returns = None
      ; panics = None
      }
  | <span data-count="0">_</span> -&gt; fail (Runtime_error (TypeCheckFailed "func call"))
;;

let save_builtins =
  save_global_i<span data-count="5">d</span> "true" (Value_bool true)
  *<span data-count="5">&gt;</span> save_global_i<span data-count="5">d</span> "false" (Value_bool false)
  *<span data-count="5">&gt;</span> save_global_i<span data-count="5">d</span> "nil" (Value_nil Nil)
  *<span data-count="5">&gt;</span> save_global_i<span data-count="5">d</span> "print" (Value_func (Func_builtin Print))
  *<span data-count="5">&gt;</span> save_global_i<span data-count="5">d</span> "println" (Value_func (Func_builtin Println))
  *<span data-count="5">&gt;</span> save_global_i<span data-count="5">d</span> "make" (Value_func (Func_builtin Make))
  *<span data-count="5">&gt;</span> save_global_i<span data-count="5">d</span> "close" (Value_func (Func_builtin Close))
  *<span data-count="5">&gt;</span> save_global_i<span data-count="5">d</span> "len" (Value_func (Func_builtin Len))
  *<span data-count="5">&gt;</span> save_global_i<span data-count="5">d</span> "recover" (Value_func (Func_builtin Recover))
  *<span data-count="5">&gt;</span> save_global_i<span data-count="5">d</span> "panic" (Value_func (Func_builtin Panic))
;;

let save_global_vars_and_funcs file =
  <span data-count="45">s</span>ave_builtins
  *<span data-count="45">&gt;</span> create_goroutin<span data-count="45">e</span> (* goroutine for global variables evaluating *)
       { local_envs =
           { exec_block = []; var_map = MapIdent.empty; env_type = Default }, []
       ; deferred_funcs = []
       ; returns = None
       ; panics = None
       }
  *<span data-count="45">&gt;</span> run_ready_goroutine
  *<span data-count="45">&gt;</span> ite<span data-count="45">r</span>
       (function
         | <span data-count="12">D</span>ecl_var decl -&gt; eval_long_var_decl save_global_id decl
         | <span data-count="81">D</span>ecl_func (ident, afc) -&gt;
           save_global_id ident (Value_func (Func_initialized (Default, afc))))
       file
  *&gt; delete_running_goroutine
;;

let add_main_goroutine =
  ite<span data-count="5">r</span> (function
    | <span data-count="45">D</span>ecl_func ("main", { body; _ }) -&gt;
      create_goroutine
        { local_envs =
            { exec_block = body; var_map = MapIdent.empty; env_type = Default }, []
        ; deferred_funcs = []
        ; returns = None
        ; panics = None
        }
    | <span data-count="48">_</span> -&gt; return ())
;;

let init_state =
  { global_env = MapIdent.empty
  ; running = None
  ; ready = ReadySet.empty
  ; sending = SendingSet.empty
  ; receiving = ReceivingSet.empty
  ; chanels = ChanSet.empty, 1
  ; is_using_chanel = None
  ; next_go_id = 0
  }
;;

let eval file =
  <span data-count="45">r</span>un
    (save_global_vars_and_func<span data-count="45">s</span> file
     *<span data-count="45">&gt;</span> add_main_goroutin<span data-count="45">e</span> file
     *<span data-count="45">&gt;</span> run_ready_goroutine<span data-count="45">s</span> eval_stmt)
    init_state
  |&gt; <span data-count="45">f</span>unction
  | <span data-count="45">_</span>, res -&gt; res
;;
</code></pre>
      </div>
    </div>
    <script src="../../coverage.js"></script>
  </body>
</html>
